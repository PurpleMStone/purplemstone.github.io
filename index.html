<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.0" color="#222">
  <link rel="alternate" href="/atom.xml" title="Stone's Blog" type="application/atom+xml">

<link rel="stylesheet" href="/css/main.css?v=7.4.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.4.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: true,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":5,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'å¤åˆ¶',
      copy_success: 'å¤åˆ¶æˆåŠŸ',
      copy_failure: 'å¤åˆ¶å¤±è´¥'
    },
    sidebarPadding: 40
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Stone&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Stone&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Purple M. Stone">
<meta name="twitter:card" content="summary">
  <link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Stone's Blog</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Stone's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <button aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>é¦–é¡µ</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>æ ‡ç­¾</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>åˆ†ç±»</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>å½’æ¡£</a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="menu-item-icon fa fa-search fa-fw"></i> <br>æœç´¢</a>
      </li>
    
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="æœç´¢..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            
  <div id="posts" class="posts-expand">
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/09/06/20210906_setup_%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AEgo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Purple M. Stone">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Stone's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2021/09/06/20210906_setup_%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AEgo/" class="post-title-link" itemprop="url">å®‰è£…é…ç½®Go</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-09-06 11:31:09 / ä¿®æ”¹æ—¶é—´ï¼š11:30:08" itemprop="dateCreated datePublished" datetime="2021-09-06T11:31:09+08:00">2021-09-06</time>
            </span>
          
            

            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Setup/" itemprop="url" rel="index"><span itemprop="name">Setup</span></a></span>

                
                
              
            </span>
          

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
        
      
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/2021/09/06/20210906_setup_%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AEgo/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2021/09/06/20210906_setup_%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AEgo/" itemprop="commentCount"></span></a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>æŒ‰ç…§å¾®è½¯æ•™ç¨‹å®‰è£…å³å¯ï¼š</p>
<p><a href="https://docs.microsoft.com/zh-cn/learn/paths/go-first-steps/" target="_blank" rel="noopener">https://docs.microsoft.com/zh-cn/learn/paths/go-first-steps/</a></p>
<p><strong>è¸©å‘</strong></p>
<ul>
<li>å›½å†…ä¸‹è½½Goé“¾æ¥:</li>
</ul>
<p><a href="https://golang.google.cn/dl/" target="_blank" rel="noopener">https://golang.google.cn/dl/</a></p>
<ul>
<li>VS Code å®‰è£… Goæ’ä»¶å¤±è´¥è§£å†³ï¼š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go env -w GO111MODULE=on                      //å¼€å¯mod</span><br><span class="line">$ go env -w GOPROXY=https://goproxy.cn,direct   //è®¾ç½®ä¸ƒç‰›äº‘goproxyä»£ç†</span><br></pre></td></tr></table></figure>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/05/19/20210519_SQL008/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Purple M. Stone">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Stone's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2021/05/19/20210519_SQL008/" class="post-title-link" itemprop="url">MySQLç¬”è®°(8)--å­˜å‚¨è¿‡ç¨‹(Stored Procedures)</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-05-19 23:00:09" itemprop="dateCreated datePublished" datetime="2021-05-19T23:00:09+08:00">2021-05-19</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-05-20 19:46:43" itemprop="dateModified" datetime="2021-05-20T19:46:43+08:00">2021-05-20</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Database/" itemprop="url" rel="index"><span itemprop="name">Database</span></a></span>

                
                
              
            </span>
          

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
        
      
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/2021/05/19/20210519_SQL008/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2021/05/19/20210519_SQL008/" itemprop="commentCount"></span></a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-ä¼˜ç‚¹"><a href="#1-ä¼˜ç‚¹" class="headerlink" title="1 ä¼˜ç‚¹"></a>1 ä¼˜ç‚¹</h1><blockquote>
<p>Store and organize SQL<br>Faster execution<br>Data security</p>
</blockquote>
<h1 id="2-åˆ›å»ºä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹"><a href="#2-åˆ›å»ºä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹" class="headerlink" title="2 åˆ›å»ºä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹"></a>2 åˆ›å»ºä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> get_clients()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> clients;	<span class="comment">-- body of procedure</span></span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;				<span class="comment">-- å°†åˆ†éš”ç¬¦å®šä¹‰å›åˆ†å·</span></span><br></pre></td></tr></table></figure>
<p>DELIMITER é‡å®šä¹‰åˆ†éš”ç¬¦, ä¹Ÿå°±æ˜¯å°†æ–°åˆ†éš”ç¬¦åŒ…å«çš„å†…å®¹è§†ä¸ºä¸€ä¸ªunit, è€Œä¸æ˜¯å°†â€;â€ç»“æŸçš„ä¸€ä¸ªä¸ªè¯­å¥è§†ä¸ºunit.</p>
<p>è°ƒç”¨å­˜å‚¨è¿‡ç¨‹:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CALL</span> get_clients()</span><br></pre></td></tr></table></figure>
<h1 id="3-åˆ é™¤å­˜å‚¨è¿‡ç¨‹"><a href="#3-åˆ é™¤å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="3 åˆ é™¤å­˜å‚¨è¿‡ç¨‹"></a>3 åˆ é™¤å­˜å‚¨è¿‡ç¨‹</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> get_clients;</span><br></pre></td></tr></table></figure>
<p><strong>åˆ›å»ºå­˜å‚¨è¿‡ç¨‹çš„åŸºæœ¬æ¡†æ¶</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> get_clients;</span><br><span class="line"></span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> get_clients()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> clients;	</span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<h1 id="4-å‚æ•°"><a href="#4-å‚æ•°" class="headerlink" title="4 å‚æ•°"></a>4 å‚æ•°</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> get_clients_by_state;</span><br><span class="line"></span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> get_clients_by_state</span><br><span class="line">(</span><br><span class="line">    state <span class="built_in">CHAR</span>(<span class="number">2</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> clients c</span><br><span class="line">    <span class="keyword">WHERE</span> c.state = state;</span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CALL</span> get_clients_by_state(<span class="string">'CA'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="4-1-å¸¦é»˜è®¤å€¼çš„å‚æ•°"><a href="#4-1-å¸¦é»˜è®¤å€¼çš„å‚æ•°" class="headerlink" title="4.1 å¸¦é»˜è®¤å€¼çš„å‚æ•°"></a>4.1 å¸¦é»˜è®¤å€¼çš„å‚æ•°</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> get_clients_by_state;</span><br><span class="line"></span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> get_clients_by_state</span><br><span class="line">(</span><br><span class="line">    state <span class="built_in">CHAR</span>(<span class="number">2</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">IF</span> state <span class="keyword">IS</span> <span class="literal">NULL</span> <span class="keyword">THEN</span>			<span class="comment">----------</span></span><br><span class="line">        <span class="keyword">SET</span> state = <span class="string">'CA'</span>;			<span class="comment">----------</span></span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">IF</span>;							<span class="comment">----------</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> clients c</span><br><span class="line">    <span class="keyword">WHERE</span> c.state = state;</span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CALL</span> get_clients_by_state(<span class="literal">NULL</span>)</span><br></pre></td></tr></table></figure>
<p><strong>IF-ELSE</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> get_clients_by_state;</span><br><span class="line"></span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> get_clients_by_state</span><br><span class="line">(</span><br><span class="line">    state <span class="built_in">CHAR</span>(<span class="number">2</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">IF</span> state <span class="keyword">IS</span> <span class="literal">NULL</span> <span class="keyword">THEN</span></span><br><span class="line">        <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> clients;</span><br><span class="line">	ELSE</span><br><span class="line">        <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> clients c</span><br><span class="line">        <span class="keyword">WHERE</span> c.state = state;</span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p>æ›´ç®€æ´çš„å†™æ³•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> get_clients_by_state;</span><br><span class="line"></span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> get_clients_by_state</span><br><span class="line">(</span><br><span class="line">    state <span class="built_in">CHAR</span>(<span class="number">2</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> clients c</span><br><span class="line">    <span class="keyword">WHERE</span> c.state = <span class="keyword">IFNULL</span>(state, c.state);    </span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p>IFNULL(state, c.state) å¦‚æœ state = NULLï¼Œåˆ™è¿”å› c.stateï¼Œè€Œ c.state = c.state æ°¸è¿œä¸º TRUE</p>
<h2 id="4-2-å‚æ•°éªŒè¯"><a href="#4-2-å‚æ•°éªŒè¯" class="headerlink" title="4.2 å‚æ•°éªŒè¯"></a>4.2 å‚æ•°éªŒè¯</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> make_payment;</span><br><span class="line"></span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> make_payment(</span><br><span class="line">    invoice_id <span class="built_in">INT</span>,</span><br><span class="line">    payment_amount <span class="built_in">DECIMAL</span>(<span class="number">9</span>, <span class="number">2</span>),</span><br><span class="line">    payment_date <span class="built_in">DATE</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">IF</span> payment_amount &lt;= <span class="number">0</span> <span class="keyword">THEN</span></span><br><span class="line">        SIGNAL <span class="keyword">SQLSTATE</span> <span class="string">'22003'</span> 		<span class="comment">-- é”™è¯¯ç </span></span><br><span class="line">            <span class="keyword">SET</span> MESSAGE_TEXT = <span class="string">'Invalid payment amount'</span>;	<span class="comment">-- è¾“å‡ºé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">UPDATE</span> invoices i</span><br><span class="line">    <span class="keyword">SET</span></span><br><span class="line">        i.payment_total = payment_amount,</span><br><span class="line">        i.payment_date = payment_date</span><br><span class="line">	<span class="keyword">WHERE</span> i.invoice_id = invoice_id;</span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<h2 id="4-3-è¾“å‡ºå‚æ•°"><a href="#4-3-è¾“å‡ºå‚æ•°" class="headerlink" title="4.3 è¾“å‡ºå‚æ•°"></a>4.3 è¾“å‡ºå‚æ•°</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> get_unpaid_invoices_for_client;</span><br><span class="line"></span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> get_unpaid_invoices_for_client(</span><br><span class="line">    client_id <span class="built_in">INT</span>,</span><br><span class="line">    <span class="keyword">OUT</span> invoices_count <span class="built_in">INT</span>,						<span class="comment">-- ----------------</span></span><br><span class="line">    <span class="keyword">OUT</span> invoices_total <span class="built_in">DECIMAL</span>(<span class="number">9</span>, <span class="number">2</span>)			<span class="comment">-- ----------------</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*), <span class="keyword">SUM</span>(invoice_total)</span><br><span class="line">	<span class="keyword">INTO</span> invoices_count, invoices_total			<span class="comment">-- ----------------</span></span><br><span class="line">    <span class="keyword">FROM</span> invoices i</span><br><span class="line">    <span class="keyword">WHERE</span> i.client_id = client_id</span><br><span class="line">	    <span class="keyword">AND</span> payment_total = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> @invoices_count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">set</span> @invoices_total = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">call</span> sql_invoicing.get_unpaid_invoices_for_client</span><br><span class="line">    (<span class="number">3</span>, @invoices_count, @invoices_total);</span><br><span class="line"><span class="keyword">select</span> @invoices_count, @invoices_total;</span><br></pre></td></tr></table></figure>
<h1 id="5-å˜é‡"><a href="#5-å˜é‡" class="headerlink" title="5 å˜é‡"></a>5 å˜é‡</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- User or session variables</span></span><br><span class="line"><span class="keyword">set</span> @invoices_count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Local variable</span></span><br><span class="line"><span class="comment">-- åœ¨å­˜å‚¨è¿‡ç¨‹æˆ–å‡½æ•°ä¸­å®šä¹‰</span></span><br></pre></td></tr></table></figure>
<p><strong>Demo</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> get_risk_factor;</span><br><span class="line"></span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> get_risk_factor()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">-- Local variables</span></span><br><span class="line">    <span class="keyword">DECLARE</span> risk_factor <span class="built_in">DECIMAL</span>(<span class="number">9</span>, <span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> invoices_total <span class="built_in">DECIMAL</span>(<span class="number">9</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> invoices_count <span class="built_in">INT</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*), <span class="keyword">SUM</span>(invoice_total)</span><br><span class="line">    <span class="keyword">INTO</span> invoices_count, invoices_total</span><br><span class="line">    <span class="keyword">FROM</span> invoices;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">SET</span> risk_factor = invoices_total / invoices_count * <span class="number">5</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">SELECT</span> risk_factor;</span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<h1 id="6-å‡½æ•°"><a href="#6-å‡½æ•°" class="headerlink" title="6 å‡½æ•°"></a>6 å‡½æ•°</h1><blockquote>
<p>å‡½æ•°ï¼šåªèƒ½è¿”å›å•ä¸€å€¼<br>å­˜å‚¨è¿‡ç¨‹ï¼šå¯ä»¥è¿”å›æ‹¥æœ‰å¤šè¡Œå¤šåˆ—çš„ç»“æœé›†</p>
<p>ğŸ‘‰ å‡½æ•°å±æ€§</p>
<ul>
<li>DETERMINISTIC: ä¸€æ ·çš„è¾“å…¥æ€»æ˜¯ä¼šè¿”å›ä¸€æ ·çš„è¾“å‡º</li>
<li>READS SQL DATA: å‡½æ•°ä¸­æœ‰è¯»sqlæ•°æ®çš„å†…å®¹</li>
<li>MODIFIES SQL DATAï¼šå‡½æ•°ä¸­æœ‰ä¿®æ”¹sqlæ•°æ®çš„å†…å®¹ </li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> get_risk_factor_for_client;</span><br><span class="line"></span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> get_risk_factor_for_client</span><br><span class="line">(</span><br><span class="line">    client_id <span class="built_in">INT</span></span><br><span class="line">) </span><br><span class="line"><span class="keyword">RETURNS</span> <span class="built_in">int</span></span><br><span class="line"><span class="keyword">READS</span> <span class="keyword">SQL</span> <span class="keyword">DATA</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> risk_factor <span class="built_in">DECIMAL</span>(<span class="number">9</span>, <span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> invoices_total <span class="built_in">DECIMAL</span>(<span class="number">9</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> invoices_count <span class="built_in">INT</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*), <span class="keyword">SUM</span>(invoice_total)</span><br><span class="line">    <span class="keyword">INTO</span> invoices_count, invoices_total</span><br><span class="line">    <span class="keyword">FROM</span> invoices i</span><br><span class="line">    <span class="keyword">WHERE</span> i.client_id = client_id;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">SET</span> risk_factor = invoices_total / invoices_count * <span class="number">5</span>;</span><br><span class="line">    RETURN IFNULL(risk_factor, 0);</span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨å‡½æ•°ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    client_id,</span><br><span class="line">    <span class="keyword">name</span>,</span><br><span class="line">    get_risk_factor_for_client(client_id) <span class="keyword">AS</span> risk_factor</span><br><span class="line"><span class="keyword">FROM</span> clients</span><br></pre></td></tr></table></figure>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/05/19/20210520_SQL009/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Purple M. Stone">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Stone's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2021/05/19/20210520_SQL009/" class="post-title-link" itemprop="url">MySQLç¬”è®°(9)--è§¦å‘å™¨(Triggers)</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-05-19 23:00:09" itemprop="dateCreated datePublished" datetime="2021-05-19T23:00:09+08:00">2021-05-19</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-05-20 19:39:16" itemprop="dateModified" datetime="2021-05-20T19:39:16+08:00">2021-05-20</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Database/" itemprop="url" rel="index"><span itemprop="name">Database</span></a></span>

                
                
              
            </span>
          

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
        
      
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/2021/05/19/20210520_SQL009/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2021/05/19/20210520_SQL009/" itemprop="commentCount"></span></a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p><strong>Trigger</strong>: A block of SQL code that automatically gets executed before or after an insert, update or delete statement.</p>
<p>To enhance data consistency</p>
</blockquote>
<h1 id="1-è®¾ç½®è§¦å‘å™¨"><a href="#1-è®¾ç½®è§¦å‘å™¨" class="headerlink" title="1 è®¾ç½®è§¦å‘å™¨"></a>1 è®¾ç½®è§¦å‘å™¨</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> payments_after_insert</span><br><span class="line">    <span class="keyword">AFTER</span> <span class="keyword">INSERT</span> <span class="keyword">ON</span> payments</span><br><span class="line">    <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span>		<span class="comment">-- ä½œç”¨äºå—å½±å“çš„æ¯ä¸€è¡Œ</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">UPDATE</span> invoices</span><br><span class="line">    <span class="keyword">SET</span> payment_total = payment_total + NEW.amount</span><br><span class="line">    <span class="keyword">WHERE</span> invoice_id = NEW.invoice_id;</span><br><span class="line"><span class="keyword">END</span> $$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥è§¦å‘é™¤äº† payments ä¹‹å¤–çš„ä»»ä½•è¡¨çš„æ›´æ–°ã€‚NEWè¡¨ç¤ºæ–° insert çš„ payment (amountæ˜¯payments è¡¨çš„ column)ã€‚å¦‚æœæ˜¯DELETEï¼Œå°±ç”¨ OLD è¡¨ç¤ºåˆ é™¤çš„è¡Œã€‚</p>
<h1 id="2-æŸ¥çœ‹è§¦å‘å™¨"><a href="#2-æŸ¥çœ‹è§¦å‘å™¨" class="headerlink" title="2 æŸ¥çœ‹è§¦å‘å™¨"></a>2 æŸ¥çœ‹è§¦å‘å™¨</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TRIGGERS</span> <span class="keyword">LIKE</span> <span class="string">'payments%'</span>		<span class="comment">-- show filtered triggers</span></span><br></pre></td></tr></table></figure>
<h1 id="3-åˆ é™¤è§¦å‘å™¨"><a href="#3-åˆ é™¤è§¦å‘å™¨" class="headerlink" title="3 åˆ é™¤è§¦å‘å™¨"></a>3 åˆ é™¤è§¦å‘å™¨</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> payments_after_insert</span><br></pre></td></tr></table></figure>
<h1 id="4-ä½¿ç”¨è§¦å‘å™¨è¿›è¡Œå®¡è®¡"><a href="#4-ä½¿ç”¨è§¦å‘å™¨è¿›è¡Œå®¡è®¡" class="headerlink" title="4 ä½¿ç”¨è§¦å‘å™¨è¿›è¡Œå®¡è®¡"></a>4 ä½¿ç”¨è§¦å‘å™¨è¿›è¡Œå®¡è®¡</h1><p><strong>ä½¿ç”¨è§¦å‘å™¨è¿›è¡Œè®°å½•</strong></p>
<p>é¦–å…ˆå»ºç«‹å®¡è®¡è¡¨ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> sql_invoicing;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> payments_audit</span><br><span class="line">(</span><br><span class="line">    client_id    <span class="built_in">INT</span>              <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="built_in">date</span>         <span class="built_in">DATE</span>             <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    amount       <span class="built_in">DECIMAL</span>(<span class="number">9</span>, <span class="number">2</span>)    <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    action_type  <span class="built_in">VARCHAR</span>(<span class="number">50</span>)      <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    action_date  DATETIME         <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>å‡å¦‚æœ‰è¿™ä¸¤ä¸ªè§¦å‘å™¨ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> payments_after_insert;</span><br><span class="line"></span><br><span class="line">DELIMITER $$</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> payments_after_insert</span><br><span class="line">    <span class="keyword">AFTER</span> <span class="keyword">INSERT</span> <span class="keyword">ON</span> payments</span><br><span class="line">    <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span>	</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">UPDATE</span> invoices</span><br><span class="line">    <span class="keyword">SET</span> payment_total = payment_total + NEW.amount</span><br><span class="line">    <span class="keyword">WHERE</span> invoice_id = NEW.invoice_id;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> payments_audit</span><br><span class="line">    <span class="keyword">VALUES</span> (NEW.client_id, NEW.date, NEW.amount, <span class="string">'Insert'</span>, <span class="keyword">NOW</span>());</span><br><span class="line"><span class="keyword">END</span> $$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> payments_after_delete;</span><br><span class="line"></span><br><span class="line">DELIMITER $$</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> payments_after_delete</span><br><span class="line">    <span class="keyword">AFTER</span> <span class="keyword">DELETE</span> <span class="keyword">ON</span> payments</span><br><span class="line">    <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span>	</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">UPDATE</span> invoices</span><br><span class="line">    <span class="keyword">SET</span> payment_total = payment_total - OLD.amount</span><br><span class="line">    <span class="keyword">WHERE</span> invoice_id = OLD.invoice_id;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> payments_audit</span><br><span class="line">    <span class="keyword">VALUES</span> (OLD.client_id, OLD.date, OLD.amount, <span class="string">'Delete'</span>, <span class="keyword">NOW</span>());</span><br><span class="line"><span class="keyword">END</span> $$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p>ç„¶åè§¦å‘äº‹ä»¶å‘ç”Ÿï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> payments</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="keyword">DEFAULT</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="string">'2019-01-01'</span>, <span class="number">10</span>, <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> payments</span><br><span class="line"><span class="keyword">WHERE</span> payment_id = <span class="number">11</span></span><br></pre></td></tr></table></figure>
<p>åˆ·æ–°å®¡è®¡è¡¨å¯ä»¥çœ‹åˆ°ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>client_id</th>
<th>date</th>
<th>amount</th>
<th>action_type</th>
<th>action_date</th>
</tr>
</thead>
<tbody>
<tr>
<td>5</td>
<td>2019-01-01</td>
<td>10.00</td>
<td>Insert</td>
<td>2021-05-20 19:12:31</td>
</tr>
<tr>
<td>5</td>
<td>2019-01-01</td>
<td>10.00</td>
<td>Delete</td>
<td>2021-05-20 19:13:31</td>
</tr>
</tbody>
</table>
</div>
<h1 id="5-äº‹ä»¶"><a href="#5-äº‹ä»¶" class="headerlink" title="5 äº‹ä»¶"></a>5 äº‹ä»¶</h1><blockquote>
<p><strong>Event</strong>: A task (or block of SQL code) that gets executed according to a <strong>schedule</strong>.</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'event%'</span>		<span class="comment">-- æŸ¥çœ‹å‘½åä¸­æœ‰eventçš„å˜é‡</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> event_scheduler = <span class="keyword">OFF</span>	<span class="comment">-- å…³æ‰å®ƒ</span></span><br></pre></td></tr></table></figure>
<p><strong>Demo</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EVENT</span> yearly_delete_stale_audit_rows		 <span class="comment">-- æ¯å¹´è§¦å‘ä¸€æ¬¡ï¼šyearlyå¼€å¤´</span></span><br><span class="line"><span class="keyword">ON</span> SCHEDULE</span><br><span class="line">    EVERY <span class="number">1</span> <span class="keyword">YEAR</span> STARTS <span class="string">'2019-01-01'</span> ENDS <span class="string">'2029-01-01'</span></span><br><span class="line"><span class="keyword">DO</span> <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DELETE</span> <span class="keyword">FROM</span> payments_audit</span><br><span class="line">    <span class="keyword">WHERE</span> action_date &lt; <span class="keyword">NOW</span>() - <span class="built_in">INTERVAL</span> <span class="number">1</span> <span class="keyword">YEAR</span>;  <span class="comment">-- åˆ é™¤æ‰€æœ‰è¶…è¿‡ä¸€å¹´çš„å®¡è®¡è®°å½•</span></span><br><span class="line"><span class="keyword">END</span> $$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<h1 id="6-æŸ¥çœ‹ï¼Œåˆ é™¤å’Œæ›´æ”¹äº‹ä»¶"><a href="#6-æŸ¥çœ‹ï¼Œåˆ é™¤å’Œæ›´æ”¹äº‹ä»¶" class="headerlink" title="6 æŸ¥çœ‹ï¼Œåˆ é™¤å’Œæ›´æ”¹äº‹ä»¶"></a>6 æŸ¥çœ‹ï¼Œåˆ é™¤å’Œæ›´æ”¹äº‹ä»¶</h1><p><strong>æŸ¥çœ‹äº‹ä»¶</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">EVENTS</span> <span class="keyword">LIKE</span> <span class="string">'yearly%'</span>;</span><br></pre></td></tr></table></figure>
<p><strong>åˆ é™¤äº‹ä»¶</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">EVENT</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> yearly_delete_stale_audit_rows;</span><br></pre></td></tr></table></figure>
<p><strong>æ›´æ”¹äº‹ä»¶</strong></p>
<p>ALTER EVENTï¼šè·Ÿ CREATE EVENT è¯­æ³•ä¸€æ ·ã€‚</p>
<p>å¯ä»¥ç”¨æ¥å±•ç¤ºå¯ç”¨/ç¦ç”¨äº‹ä»¶ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">EVENT</span> yearly_delete_stale_audit_rows <span class="keyword">ENABLE</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">EVENT</span> yearly_delete_stale_audit_rows <span class="keyword">DISABLE</span></span><br></pre></td></tr></table></figure>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/05/19/20210519_SQL007/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Purple M. Stone">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Stone's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2021/05/19/20210519_SQL007/" class="post-title-link" itemprop="url">MySQLç¬”è®°(7)--è§†å›¾(Views)</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-05-19 21:00:09 / ä¿®æ”¹æ—¶é—´ï¼š22:27:44" itemprop="dateCreated datePublished" datetime="2021-05-19T21:00:09+08:00">2021-05-19</time>
            </span>
          
            

            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Database/" itemprop="url" rel="index"><span itemprop="name">Database</span></a></span>

                
                
              
            </span>
          

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
        
      
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/2021/05/19/20210519_SQL007/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2021/05/19/20210519_SQL007/" itemprop="commentCount"></span></a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-åˆ›å»ºè§†å›¾"><a href="#1-åˆ›å»ºè§†å›¾" class="headerlink" title="1 åˆ›å»ºè§†å›¾"></a>1 åˆ›å»ºè§†å›¾</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> sql_invoicing;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> sales_by_client <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    c.client_id,</span><br><span class="line">    c.name,</span><br><span class="line">    <span class="keyword">SUM</span>(invoice_total) <span class="keyword">AS</span> total_sales</span><br><span class="line"><span class="keyword">FROM</span> clients c</span><br><span class="line"><span class="keyword">JOIN</span> invoices i <span class="keyword">USING</span> (client_id)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> client_id, <span class="keyword">name</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥åœ¨â€Viewsâ€çœ‹åˆ°è¿™ä¸ªè§†å›¾.å¯ä»¥åƒä½¿ç”¨tableä¸€æ ·ç”¨è§†å›¾.</p>
<h1 id="2-æ›´æ”¹æˆ–åˆ é™¤è§†å›¾"><a href="#2-æ›´æ”¹æˆ–åˆ é™¤è§†å›¾" class="headerlink" title="2 æ›´æ”¹æˆ–åˆ é™¤è§†å›¾"></a>2 æ›´æ”¹æˆ–åˆ é™¤è§†å›¾</h1><p><strong>åˆ é™¤è§†å›¾</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> sales_by_client</span><br></pre></td></tr></table></figure>
<p><strong>æ›´æ”¹è§†å›¾</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> sql_invoicing;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> sales_by_client <span class="keyword">AS</span> 	<span class="comment">-- create or replace</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    c.client_id,</span><br><span class="line">    c.name,</span><br><span class="line">    <span class="keyword">SUM</span>(invoice_total) <span class="keyword">AS</span> total_sales</span><br><span class="line"><span class="keyword">FROM</span> clients c</span><br><span class="line"><span class="keyword">JOIN</span> invoices i <span class="keyword">USING</span> (client_id)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> client_id, <span class="keyword">name</span></span><br></pre></td></tr></table></figure>
<h1 id="3-å¯æ›´æ–°è§†å›¾"><a href="#3-å¯æ›´æ–°è§†å›¾" class="headerlink" title="3 å¯æ›´æ–°è§†å›¾"></a>3 å¯æ›´æ–°è§†å›¾</h1><p>å¦‚æœè§†å›¾ä¸­æ²¡æœ‰:</p>
<blockquote>
<p>DISTINCT<br>Aggregate Functions (MIN, MAX, SUM)<br>GROUP BY / HAVING<br>UNION</p>
</blockquote>
<p>å°±æ˜¯å¯æ›´æ–°è§†å›¾,å°±å¯ä»¥å¢åˆ æ”¹:</p>
<p>æ¯”å¦‚:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> invoices_with_balance <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    invoice_id,</span><br><span class="line">    <span class="built_in">number</span>,</span><br><span class="line">    client_id,</span><br><span class="line">    invoice_total,</span><br><span class="line">    payment_total,</span><br><span class="line">    invoice_total - payment_total <span class="keyword">AS</span> balance,</span><br><span class="line">    due_date,</span><br><span class="line">    payment_date</span><br><span class="line"><span class="keyword">FROM</span> invoices</span><br><span class="line"><span class="keyword">WHERE</span> (invoice_total - payment_total) &gt; <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>invoices_with_balance å°±æ˜¯å¯æ›´æ–°è§†å›¾,å¯ä»¥å¢åˆ æ”¹:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> invoices_with_balance</span><br><span class="line"><span class="keyword">WHERE</span> invoice_id = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> invoices_with_balance</span><br><span class="line"><span class="keyword">SET</span> due_date = <span class="keyword">DATE_ADD</span>(due_date, <span class="built_in">INTERVAL</span> <span class="number">5</span> <span class="keyword">DAY</span>)</span><br><span class="line"><span class="keyword">WHERE</span> invoice_id = <span class="number">2</span></span><br></pre></td></tr></table></figure>
<h1 id="4-WITH-OPTION-CHECK-å­å¥"><a href="#4-WITH-OPTION-CHECK-å­å¥" class="headerlink" title="4 WITH OPTION CHECK å­å¥"></a>4 WITH OPTION CHECK å­å¥</h1><p>ä¸Šä¾‹ä¸­,è¿›è¡Œå¦‚ä¸‹æ›´æ”¹:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> invoices_with_balance</span><br><span class="line"><span class="keyword">SET</span> payment_total = invoice_total</span><br><span class="line"><span class="keyword">WHERE</span> invoice_id = <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>è¯¥è§†å›¾ä¸­ invoice_id = 2 çš„è¡Œæ¶ˆå¤±äº†(å› ä¸ºä¸å†æ»¡è¶³(invoice_total - payment_total) &gt; 0çš„æ¡ä»¶)</p>
<p>å¦‚æœä¸æƒ³ UPDATE æˆ– DELETE è¯­å¥ä½¿å¾—æŸäº›è¡Œä»è§†å›¾ä¸­åˆ é™¤, å°±è¿™æ ·:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> invoices_with_balance <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    invoice_id,</span><br><span class="line">    <span class="built_in">number</span>,</span><br><span class="line">    client_id,</span><br><span class="line">    invoice_total,</span><br><span class="line">    payment_total,</span><br><span class="line">    invoice_total - payment_total <span class="keyword">AS</span> balance,</span><br><span class="line">    due_date,</span><br><span class="line">    payment_date</span><br><span class="line"><span class="keyword">FROM</span> invoices</span><br><span class="line"><span class="keyword">WHERE</span> (invoice_total - payment_total) &gt; <span class="number">0</span></span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">CHECK</span> <span class="keyword">OPTION</span>			<span class="comment">-- å¢åŠ è¿™ä¸ªå­å¥,é˜²æ­¢åˆ é™¤è¡Œ</span></span><br></pre></td></tr></table></figure>
<p>åé¢å†æ‰§è¡Œè¿™æ ·çš„:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> invoices_with_balance</span><br><span class="line"><span class="keyword">SET</span> payment_total = invoice_total</span><br><span class="line"><span class="keyword">WHERE</span> invoice_id = <span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>å°±ä¼šæŠ¥é”™: </p>
<blockquote>
<p>Error Code: 1369. CHECK OPTION failed</p>
</blockquote>
<h1 id="5-è§†å›¾çš„ä¼˜ç‚¹"><a href="#5-è§†å›¾çš„ä¼˜ç‚¹" class="headerlink" title="5 è§†å›¾çš„ä¼˜ç‚¹"></a>5 è§†å›¾çš„ä¼˜ç‚¹</h1><blockquote>
<p>Simplify queries<br>Reduce the impact of changes<br>Restrict access to the data</p>
</blockquote>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/05/19/20210519_SQL006/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Purple M. Stone">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Stone's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2021/05/19/20210519_SQL006/" class="post-title-link" itemprop="url">MySQLç¬”è®°(6)--MySQLçš„åŸºæœ¬å‡½æ•°</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-05-19 19:50:09 / ä¿®æ”¹æ—¶é—´ï¼š20:14:20" itemprop="dateCreated datePublished" datetime="2021-05-19T19:50:09+08:00">2021-05-19</time>
            </span>
          
            

            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Database/" itemprop="url" rel="index"><span itemprop="name">Database</span></a></span>

                
                
              
            </span>
          

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
        
      
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/2021/05/19/20210519_SQL006/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2021/05/19/20210519_SQL006/" itemprop="commentCount"></span></a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-æ•°å€¼å‡½æ•°"><a href="#1-æ•°å€¼å‡½æ•°" class="headerlink" title="1 æ•°å€¼å‡½æ•°"></a>1 æ•°å€¼å‡½æ•°</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(<span class="number">5.7355</span>, <span class="number">2</span>) 		<span class="comment">-- ä¿ç•™å°æ•°ç‚¹å2ä½, å››èˆäº”å…¥: 5.74</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRUNCATE</span>(<span class="number">5.7355</span>, <span class="number">2</span>) 		<span class="comment">-- ä¿ç•™å°æ•°ç‚¹å2ä½: 5.73</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CEILING</span>(<span class="number">5.2</span>)				<span class="comment">-- 6 (ä¸Šå–æ•´)</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">FLOOR</span>(<span class="number">5.7</span>)				<span class="comment">-- 5 (ä¸‹å–æ•´)</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ABS</span>(<span class="number">-5.2</span>)				<span class="comment">-- æ±‚ç»å¯¹å€¼</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RAND</span>()					<span class="comment">-- å¾—åˆ°0~1çš„éšæœºå€¼</span></span><br></pre></td></tr></table></figure>
<h1 id="2-å­—ç¬¦ä¸²å‡½æ•°"><a href="#2-å­—ç¬¦ä¸²å‡½æ•°" class="headerlink" title="2 å­—ç¬¦ä¸²å‡½æ•°"></a>2 å­—ç¬¦ä¸²å‡½æ•°</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LENGTH</span>(<span class="string">'sky'</span>) 				<span class="comment">-- 3</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">UPPER</span>(<span class="string">'sky'</span>) 				<span class="comment">-- SKY</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LOWER</span>(<span class="string">'Sky'</span>)					<span class="comment">-- sky</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LTRIM</span>(<span class="string">'     Sky'</span>)			<span class="comment">-- å»é™¤å·¦è¾¹çš„ç©ºæ ¼ï¼šSky</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RTRIM</span>(<span class="string">'Sky     '</span>)			<span class="comment">-- å»é™¤å³è¾¹çš„ç©ºæ ¼ï¼šSky</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRIM</span>(<span class="string">'    Sky  '</span>)			<span class="comment">-- å»é™¤ä¸¤è¾¹çš„ç©ºæ ¼ï¼šSky</span></span><br></pre></td></tr></table></figure>
<p><strong>å­ä¸²</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LEFT</span>(<span class="string">'Kindergarten'</span>, <span class="number">4</span>)			<span class="comment">-- Kind</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RIGHT</span>(<span class="string">'Kindergarten'</span>, <span class="number">6</span>)			<span class="comment">-- garten</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUBSTRING</span>(<span class="string">'Kindergarten'</span>, <span class="number">3</span>, <span class="number">5</span>)	<span class="comment">-- nderg</span></span><br></pre></td></tr></table></figure>
<p><strong>æŸ¥æ‰¾ä½ç½®</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LOCATE</span>(<span class="string">'N'</span>, <span class="string">'Kindergarten'</span>)  	<span class="comment">-- 3 ä¸åŒºåˆ†å¤§å°å†™ï¼Œè‹¥ä¸åœ¨å­—ç¬¦ä¸²ä¸­åˆ™è¿”å›0</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LOCATE</span>(<span class="string">'garten'</span>, <span class="string">'Kindergarten'</span>)	<span class="comment">-- 7</span></span><br></pre></td></tr></table></figure>
<p><strong>æ›¿æ¢</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">REPLACE</span>(<span class="string">'Kindergarten'</span>, <span class="string">'garten'</span>, <span class="string">'garden'</span>)	<span class="comment">-- Kindergarden</span></span><br></pre></td></tr></table></figure>
<p><strong>æ‹¼æ¥</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(<span class="string">'first'</span>, <span class="string">'last'</span>)		<span class="comment">-- firstlast</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> sql_store;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(first_name, <span class="string">' '</span>, last_name) <span class="keyword">AS</span> full_name</span><br><span class="line"><span class="keyword">FROM</span> customers</span><br></pre></td></tr></table></figure>
<h1 id="3-æ—¥æœŸ"><a href="#3-æ—¥æœŸ" class="headerlink" title="3 æ—¥æœŸ"></a>3 æ—¥æœŸ</h1><h2 id="3-1-æ—¥æœŸå‡½æ•°"><a href="#3-1-æ—¥æœŸå‡½æ•°" class="headerlink" title="3.1 æ—¥æœŸå‡½æ•°"></a>3.1 æ—¥æœŸå‡½æ•°</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NOW</span>(), <span class="keyword">CURDATE</span>(), <span class="keyword">CURTIME</span>()</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th>NOW()</th>
<th>CURDATE()</th>
<th>CURTIME()</th>
</tr>
</thead>
<tbody>
<tr>
<td>2021-05-19 19:08:56</td>
<td>2021-05-19</td>
<td>19:08:56</td>
</tr>
</tbody>
</table>
</div>
<p><strong>è·å–æŒ‡å®šçš„æ—¶é—´æ„æˆå…ƒç´ </strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">YEAR</span>(<span class="keyword">NOW</span>())		<span class="comment">-- 2021</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MONTH</span>(<span class="keyword">NOW</span>())		<span class="comment">-- 5</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DAY</span>(<span class="keyword">NOW</span>())		<span class="comment">-- 19</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">HOUR</span>(<span class="keyword">NOW</span>())		<span class="comment">-- 19</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MINUTE</span>(<span class="keyword">NOW</span>())	<span class="comment">-- 08</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SECOND</span>(<span class="keyword">NOW</span>())	<span class="comment">-- 56</span></span><br></pre></td></tr></table></figure>
<p><strong>è·å–æ—¶é—´çš„å­—ç¬¦ä¸²</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DAYNAME</span>(<span class="keyword">NOW</span>()), MONTHNAME(<span class="keyword">NOW</span>())</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th>DAYNAME(NOW())</th>
<th>MONTHNAME(NOW())</th>
</tr>
</thead>
<tbody>
<tr>
<td>Wednesday</td>
<td>May</td>
</tr>
</tbody>
</table>
</div>
<p><strong>EXTRACT</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">EXTRACT</span>(<span class="keyword">DAY</span> <span class="keyword">FROM</span> <span class="keyword">NOW</span>()) 		<span class="comment">-- 19</span></span><br></pre></td></tr></table></figure>
<h2 id="3-2-æ ¼å¼åŒ–æ—¥æœŸå’Œæ—¶é—´"><a href="#3-2-æ ¼å¼åŒ–æ—¥æœŸå’Œæ—¶é—´" class="headerlink" title="3.2 æ ¼å¼åŒ–æ—¥æœŸå’Œæ—¶é—´"></a>3.2 æ ¼å¼åŒ–æ—¥æœŸå’Œæ—¶é—´</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATE_FORMAT</span>(<span class="keyword">NOW</span>(), <span class="string">'%M %d %Y'</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>May 19 2021</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATE_FORMAT</span>(<span class="keyword">NOW</span>(), <span class="string">'%H:%i %p'</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>19:17 PM</p>
</blockquote>
<h2 id="3-3-è®¡ç®—æ—¥æœŸå’Œæ—¶é—´"><a href="#3-3-è®¡ç®—æ—¥æœŸå’Œæ—¶é—´" class="headerlink" title="3.3 è®¡ç®—æ—¥æœŸå’Œæ—¶é—´"></a>3.3 è®¡ç®—æ—¥æœŸå’Œæ—¶é—´</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATE_ADD</span>(<span class="keyword">NOW</span>(), <span class="built_in">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span>)		<span class="comment">-- 	2021-05-20 19:21:32</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATE_ADD</span>(<span class="keyword">NOW</span>(), <span class="built_in">INTERVAL</span> <span class="number">1</span> <span class="keyword">YEAR</span>)		<span class="comment">-- 	2022-05-19 19:21:32</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATE_SUB</span>(<span class="keyword">NOW</span>(), <span class="built_in">INTERVAL</span> <span class="number">1</span> <span class="keyword">YEAR</span>)		<span class="comment">-- 	2020-05-19 19:21:32</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATEDIFF</span>(<span class="string">'2021-01-05'</span>, <span class="string">'2021-01-01'</span>)				<span class="comment">--  4</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TIME_TO_SEC(<span class="string">'09:00'</span>) - TIME_TO_SEC(<span class="string">'09:02'</span>) 		<span class="comment">-- 	-120 (å•ä½:ç§’)</span></span><br></pre></td></tr></table></figure>
<h1 id="4-IFNULL-å’Œ-COALESCE"><a href="#4-IFNULL-å’Œ-COALESCE" class="headerlink" title="4 IFNULL å’Œ COALESCE"></a>4 IFNULL å’Œ COALESCE</h1><p><strong>IFNULL</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> sql_store;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    order_id,</span><br><span class="line">    <span class="keyword">IFNULL</span>(shipper_id, <span class="string">'Not assigned'</span>) <span class="keyword">AS</span> shipper</span><br><span class="line"><span class="keyword">FROM</span> orders</span><br></pre></td></tr></table></figure>
<p>IFNULL(shipper_id, â€˜Not assignedâ€™) å³å¦‚æœshipper_idä¸ºNULL, å°±æ”¹ä¸ºâ€™Not assignedâ€™</p>
<p>è¾“å‡º:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>order_id</th>
<th>shipper</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Not assigned</td>
</tr>
<tr>
<td>3</td>
<td>Not assigned</td>
</tr>
<tr>
<td>8</td>
<td>Not assigned</td>
</tr>
<tr>
<td>9</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>4</td>
</tr>
</tbody>
</table>
</div>
<p><strong>COALESCE</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> sql_store;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    order_id,</span><br><span class="line">    <span class="keyword">COALESCE</span>(shipper_id, comments, <span class="string">'Not assigned'</span>) <span class="keyword">AS</span> shipper</span><br><span class="line"><span class="keyword">FROM</span> orders</span><br></pre></td></tr></table></figure>
<p>å¦‚æœshipper_idä¸ºç©º,å°±è¿”å›commentsä¸­çš„å€¼,å¦‚æœcommentsä¹Ÿä¸ºç©º,åˆ™è¿”å›â€™Not assignedâ€™.</p>
<h1 id="5-IF-å‡½æ•°"><a href="#5-IF-å‡½æ•°" class="headerlink" title="5 IF å‡½æ•°"></a>5 IF å‡½æ•°</h1><p>æ ¼å¼:</p>
<blockquote>
<p>IF(expression, first, second)<br>å¦‚æœexpressionä¸ºçœŸ,è¿”å›first, ä¸ºå‡åˆ™è¿”å›second</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    order_id,</span><br><span class="line">    order_date,</span><br><span class="line">    <span class="keyword">IF</span>(</span><br><span class="line">        <span class="keyword">YEAR</span>(order_date) = <span class="keyword">YEAR</span>(<span class="keyword">DATE_SUB</span>(<span class="keyword">NOW</span>(), <span class="built_in">INTERVAL</span> <span class="number">2</span> <span class="keyword">YEAR</span>)),</span><br><span class="line">        <span class="string">'Active'</span>,</span><br><span class="line">        <span class="string">'Archived'</span>) <span class="keyword">AS</span> <span class="keyword">category</span></span><br><span class="line"><span class="keyword">FROM</span> orders</span><br></pre></td></tr></table></figure>
<p>å½“å‰å¹´ä»½ä¸º2021, æ‰€ä»¥2019çš„ä¸ºâ€™Activeâ€™ (Moshåˆ¶ä½œè§†é¢‘æ—¶ä¸º2019), å…¶ä»–éƒ½æ˜¯â€™Archivedâ€™:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>order_id</th>
<th>order_date</th>
<th>category</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>2019-01-30</td>
<td>Active</td>
</tr>
<tr>
<td>2</td>
<td>2018-08-02</td>
<td>Archived</td>
</tr>
<tr>
<td>3</td>
<td>2017-12-01</td>
<td>Archived</td>
</tr>
<tr>
<td>4</td>
<td>2017-01-22</td>
<td>Archived</td>
</tr>
<tr>
<td>5</td>
<td>2017-08-25</td>
<td>Archived</td>
</tr>
</tbody>
</table>
</div>
<h1 id="6-CASE-è¿ç®—ç¬¦"><a href="#6-CASE-è¿ç®—ç¬¦" class="headerlink" title="6 CASE è¿ç®—ç¬¦"></a>6 CASE è¿ç®—ç¬¦</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    order_id,</span><br><span class="line">    <span class="keyword">CASE</span></span><br><span class="line">        <span class="keyword">WHEN</span> <span class="keyword">YEAR</span>(order_date) = <span class="keyword">YEAR</span>(<span class="keyword">NOW</span>()) - <span class="number">2</span> <span class="keyword">THEN</span> <span class="string">'Active'</span></span><br><span class="line">        <span class="keyword">WHEN</span> <span class="keyword">YEAR</span>(order_date) = <span class="keyword">YEAR</span>(<span class="keyword">NOW</span>()) - <span class="number">3</span> <span class="keyword">THEN</span> <span class="string">'Last Year'</span></span><br><span class="line">        <span class="keyword">WHEN</span> <span class="keyword">YEAR</span>(order_date) &lt; <span class="keyword">YEAR</span>(<span class="keyword">NOW</span>()) - <span class="number">3</span> <span class="keyword">THEN</span> <span class="string">'Archived'</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="string">'Future'</span></span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">AS</span> <span class="keyword">category</span></span><br><span class="line"><span class="keyword">FROM</span> orders</span><br></pre></td></tr></table></figure>
<p>è¾“å‡º:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>order_id</th>
<th>category</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Active</td>
</tr>
<tr>
<td>2</td>
<td>Last Year</td>
</tr>
<tr>
<td>3</td>
<td>Archived</td>
</tr>
<tr>
<td>4</td>
<td>Archived</td>
</tr>
<tr>
<td>5</td>
<td>Archived</td>
</tr>
<tr>
<td>6</td>
<td>Last Year</td>
</tr>
<tr>
<td>7</td>
<td>Last Year</td>
</tr>
<tr>
<td>8</td>
<td>Last Year</td>
</tr>
<tr>
<td>9</td>
<td>Archived</td>
</tr>
<tr>
<td>10</td>
<td>Last Year</td>
</tr>
</tbody>
</table>
</div>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/05/18/20210518_SQL005/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Purple M. Stone">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Stone's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2021/05/18/20210518_SQL005/" class="post-title-link" itemprop="url">MySQLç¬”è®°(5)--ç¼–å†™å¤æ‚æŸ¥è¯¢</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-05-18 21:50:09" itemprop="dateCreated datePublished" datetime="2021-05-18T21:50:09+08:00">2021-05-18</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-05-19 17:29:03" itemprop="dateModified" datetime="2021-05-19T17:29:03+08:00">2021-05-19</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Database/" itemprop="url" rel="index"><span itemprop="name">Database</span></a></span>

                
                
              
            </span>
          

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
        
      
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/2021/05/18/20210518_SQL005/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2021/05/18/20210518_SQL005/" itemprop="commentCount"></span></a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-å­æŸ¥è¯¢"><a href="#1-å­æŸ¥è¯¢" class="headerlink" title="1 å­æŸ¥è¯¢"></a>1 å­æŸ¥è¯¢</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Find products that are more </span></span><br><span class="line"><span class="comment">-- expensive than Lettuce (id = 3)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> products</span><br><span class="line"><span class="keyword">WHERE</span> unit_price &gt; (</span><br><span class="line">    <span class="keyword">SELECT</span> unit_price</span><br><span class="line">    <span class="keyword">FROM</span> products</span><br><span class="line">    <span class="keyword">WHERE</span> product_id = <span class="number">3</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h1 id="2-IN-è¿ç®—ç¬¦"><a href="#2-IN-è¿ç®—ç¬¦" class="headerlink" title="2 IN è¿ç®—ç¬¦"></a>2 IN è¿ç®—ç¬¦</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Find the products that have never been ordered</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">USE</span> sql_store;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> products</span><br><span class="line"><span class="keyword">WHERE</span> product_id <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> product_id</span><br><span class="line">    <span class="keyword">FROM</span> order_items</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h1 id="3-å­æŸ¥è¯¢-VS-è¿æ¥"><a href="#3-å­æŸ¥è¯¢-VS-è¿æ¥" class="headerlink" title="3 å­æŸ¥è¯¢ VS è¿æ¥"></a>3 å­æŸ¥è¯¢ VS è¿æ¥</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Find clients without invoices</span></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> clients</span><br><span class="line"><span class="keyword">WHERE</span> client_id <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> client_id</span><br><span class="line">    <span class="keyword">FROM</span> invoices</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>ç”¨è¿æ¥çš„æ–¹æ³•:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> clients</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> invoices <span class="keyword">USING</span> (client_id)</span><br><span class="line"><span class="keyword">WHERE</span> invoice_id <span class="keyword">IS</span> <span class="literal">NULL</span></span><br></pre></td></tr></table></figure>
<p>åœ¨æ—¶é—´ä¸€æ ·çš„æƒ…å†µä¸‹, é€‰æ‹©æ›´æ˜“è¯»çš„é‚£ç§æ–¹æ³•</p>
<h1 id="4-ALL-å…³é”®å­—"><a href="#4-ALL-å…³é”®å­—" class="headerlink" title="4 ALL å…³é”®å­—"></a>4 ALL å…³é”®å­—</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Select invoices larger than all invoices of client 3</span></span><br><span class="line"><span class="keyword">USE</span> sql_invoicing;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> invoices</span><br><span class="line"><span class="keyword">WHERE</span> invoice_total &gt; (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">MAX</span>(invoice_total)</span><br><span class="line">    <span class="keyword">FROM</span> invoices</span><br><span class="line">    <span class="keyword">WHERE</span> client_id = <span class="number">3</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>æ”¹ç”¨all å…³é”®å­—:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> invoices</span><br><span class="line"><span class="keyword">WHERE</span> invoice_total &gt; <span class="keyword">ALL</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> invoice_total</span><br><span class="line">    <span class="keyword">FROM</span> invoices</span><br><span class="line">    <span class="keyword">WHERE</span> client_id = <span class="number">3</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h1 id="5-ANY-å…³é”®å­—"><a href="#5-ANY-å…³é”®å­—" class="headerlink" title="5 ANY å…³é”®å­—"></a>5 ANY å…³é”®å­—</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Select clients with at least two invoices</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> clients</span><br><span class="line"><span class="keyword">WHERE</span> client_id <span class="keyword">IN</span>  (</span><br><span class="line">    <span class="keyword">SELECT</span> client_id</span><br><span class="line">    <span class="keyword">FROM</span> invoices</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> client_id</span><br><span class="line">    <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*) &gt;= <span class="number">2</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>æ”¹ç”¨any å…³é”®å­—</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Select clients with at least two invoices</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> clients</span><br><span class="line"><span class="keyword">WHERE</span> client_id = <span class="keyword">ANY</span>  (</span><br><span class="line">    <span class="keyword">SELECT</span> client_id</span><br><span class="line">    <span class="keyword">FROM</span> invoices</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> client_id</span><br><span class="line">    <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*) &gt;= <span class="number">2</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>å³ â€œINâ€ ç›¸å½“äº â€œ=ANYâ€</p>
<h1 id="6-ç›¸å…³å­æŸ¥è¯¢"><a href="#6-ç›¸å…³å­æŸ¥è¯¢" class="headerlink" title="6 ç›¸å…³å­æŸ¥è¯¢"></a>6 ç›¸å…³å­æŸ¥è¯¢</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Select employees whose salary is </span></span><br><span class="line"><span class="comment">-- above the average in their office</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">USE</span> sql_hr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span> salary &gt; (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">AVG</span>(salary)</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">WHERE</span> office_id = e.office_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„åˆ°å­æŸ¥è¯¢ç”¨åˆ°äº†å¤–æŸ¥è¯¢çš„ e.office_id, ä¹Ÿå°±æ˜¯è¯´å­æŸ¥è¯¢å’Œå¤–æŸ¥è¯¢æ˜¯ç›¸å…³å­æŸ¥è¯¢.</p>
<p>å¯¹äºéç›¸å…³å­æŸ¥è¯¢, æ‰§è¡Œä¸€æ¬¡å°±å¯ä»¥äº†.</p>
<p>ä½†æ˜¯å¯¹äºç›¸å…³å­æŸ¥è¯¢, å¤–æŸ¥è¯¢æ¯ä¸€æ¡recordéƒ½è¦æ‰§è¡Œä¸€æ¬¡å­æŸ¥è¯¢,æ‰€ä»¥æ‰§è¡Œæ—¶é—´ç›¸å¯¹è¾ƒé•¿.</p>
<h1 id="7-EXISTS-è¿ç®—ç¬¦"><a href="#7-EXISTS-è¿ç®—ç¬¦" class="headerlink" title="7 EXISTS è¿ç®—ç¬¦"></a>7 EXISTS è¿ç®—ç¬¦</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Select clients that have an invoice</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> clients</span><br><span class="line"><span class="keyword">WHERE</span> client_id <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> client_id</span><br><span class="line">    <span class="keyword">FROM</span> invoices</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>å­æŸ¥è¯¢è¿”å›ä¸€ä¸ªåˆ—è¡¨, ç„¶åå¤–æŸ¥è¯¢çœ‹åœ¨ä¸åœ¨æ­¤åˆ—è¡¨ä¸­.å¦‚æœå­æŸ¥è¯¢è¿”å›çš„åˆ—è¡¨éå¸¸å¤§,å°±ä¼šå¾ˆå½±å“æ€§èƒ½.</p>
<p><strong>ä½¿ç”¨EXISTSè¿ç®—ç¬¦</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Select clients that have an invoice</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> clients c</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> client_id</span><br><span class="line">    <span class="keyword">FROM</span> invoices</span><br><span class="line">    <span class="keyword">WHERE</span> client_id = c.client_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>å¯¹äºå¤–æŸ¥è¯¢çš„æ¯ä¸€æ¡record, EXISTS å­æŸ¥è¯¢è¿”å›TRUE / FALSE, è‹¥è¿”å›TRUE,å°±æ·»åŠ åˆ°ç»“æœé›†ä¸­.</p>
<p><strong>Exercise</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Find the products that have never been ordered</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> products p</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> product_id</span><br><span class="line">    <span class="keyword">FROM</span> order_items</span><br><span class="line">    <span class="keyword">WHERE</span> product_id = p.product_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h1 id="8-SELECT-å­å¥ä¸­çš„å­æŸ¥è¯¢"><a href="#8-SELECT-å­å¥ä¸­çš„å­æŸ¥è¯¢" class="headerlink" title="8 SELECT å­å¥ä¸­çš„å­æŸ¥è¯¢"></a>8 SELECT å­å¥ä¸­çš„å­æŸ¥è¯¢</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    invoice_id,</span><br><span class="line">    invoice_total,</span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="keyword">AVG</span>(invoice_total)</span><br><span class="line">        <span class="keyword">FROM</span> invoices) <span class="keyword">AS</span> invoice_average,</span><br><span class="line">	invoice_total - (<span class="keyword">SELECT</span> invoice_average) <span class="keyword">AS</span> <span class="keyword">difference</span> <span class="comment">-- ä¸èƒ½ç›´æ¥ç”¨åˆ«å</span></span><br><span class="line"><span class="keyword">FROM</span> invoices</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°è¿™æ ·ä¸€å¼ è¡¨:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>invoice_id</th>
<th>invoice_total</th>
<th>invoice_average</th>
<th>difference</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>101.79</td>
<td>152.388235</td>
<td>-50.598235</td>
</tr>
<tr>
<td>2</td>
<td>175.32</td>
<td>152.388235</td>
<td>22.931765</td>
</tr>
<tr>
<td>3</td>
<td>147.99</td>
<td>152.388235</td>
<td>-4.398235</td>
</tr>
<tr>
<td>4</td>
<td>152.21</td>
<td>152.388235</td>
<td>-0.178235</td>
</tr>
<tr>
<td>5</td>
<td>169.36</td>
<td>152.388235</td>
<td>16.971765</td>
</tr>
<tr>
<td>6</td>
<td>157.78</td>
<td>152.388235</td>
<td>5.391765</td>
</tr>
<tr>
<td>7</td>
<td>133.87</td>
<td>152.388235</td>
<td>-18.518235</td>
</tr>
</tbody>
</table>
</div>
<p><strong>Exercise</strong></p>
<p>å¾—åˆ°è¿™æ ·ä¸€å¼ è¡¨:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>client_id</th>
<th>name</th>
<th>total_sales</th>
<th>average</th>
<th>difference</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Vinte</td>
<td>802.89</td>
<td>152.388235</td>
<td>650.501765</td>
</tr>
<tr>
<td>2</td>
<td>Myworks</td>
<td>101.79</td>
<td>152.388235</td>
<td>-50.598235</td>
</tr>
<tr>
<td>3</td>
<td>Yadel</td>
<td>705.90</td>
<td>152.388235</td>
<td>553.511765</td>
</tr>
<tr>
<td>4</td>
<td>Kwideo</td>
<td></td>
<td>152.388235</td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>Topiclounge</td>
<td>980.02</td>
<td>152.388235</td>
<td>827.631765</td>
</tr>
</tbody>
</table>
</div>
<p>Solution:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    client_id,</span><br><span class="line">    <span class="keyword">name</span>,</span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="keyword">SUM</span>(invoice_total) </span><br><span class="line">        <span class="keyword">FROM</span> invoices</span><br><span class="line">        <span class="keyword">WHERE</span> client_id = c.client_id) <span class="keyword">AS</span> total_sales,</span><br><span class="line">	(<span class="keyword">SELECT</span> <span class="keyword">AVG</span>(invoice_total) <span class="keyword">FROM</span> invoices) <span class="keyword">AS</span> average,</span><br><span class="line">    (<span class="keyword">SELECT</span> total_sales - average) <span class="keyword">AS</span> <span class="keyword">difference</span></span><br><span class="line"><span class="keyword">FROM</span> clients c</span><br></pre></td></tr></table></figure>
<h1 id="9-FROM-å­å¥ä¸­çš„å­æŸ¥è¯¢"><a href="#9-FROM-å­å¥ä¸­çš„å­æŸ¥è¯¢" class="headerlink" title="9 FROM å­å¥ä¸­çš„å­æŸ¥è¯¢"></a>9 FROM å­å¥ä¸­çš„å­æŸ¥è¯¢</h1><p>å°†ä¸Šé¢çš„æŸ¥è¯¢ç»“æœå½“æˆè¡¨æ¥ç”¨,æ”¾åœ¨FROM å­å¥ä¸­:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">        client_id,</span><br><span class="line">        <span class="keyword">name</span>,</span><br><span class="line">        (<span class="keyword">SELECT</span> <span class="keyword">SUM</span>(invoice_total) </span><br><span class="line">            <span class="keyword">FROM</span> invoices</span><br><span class="line">            <span class="keyword">WHERE</span> client_id = c.client_id) <span class="keyword">AS</span> total_sales,</span><br><span class="line">        (<span class="keyword">SELECT</span> <span class="keyword">AVG</span>(invoice_total) <span class="keyword">FROM</span> invoices) <span class="keyword">AS</span> average,</span><br><span class="line">        (<span class="keyword">SELECT</span> total_sales - average) <span class="keyword">AS</span> <span class="keyword">difference</span></span><br><span class="line">    <span class="keyword">FROM</span> clients c</span><br><span class="line">) <span class="keyword">AS</span> sales_summary</span><br><span class="line"><span class="keyword">WHERE</span> total_sales <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>client_id</th>
<th>name</th>
<th>total_sales</th>
<th>average</th>
<th>difference</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Vinte</td>
<td>802.89</td>
<td>152.388235</td>
<td>650.501765</td>
</tr>
<tr>
<td>2</td>
<td>Myworks</td>
<td>101.79</td>
<td>152.388235</td>
<td>-50.598235</td>
</tr>
<tr>
<td>3</td>
<td>Yadel</td>
<td>705.90</td>
<td>152.388235</td>
<td>553.511765</td>
</tr>
<tr>
<td>5</td>
<td>Topiclounge</td>
<td>980.02</td>
<td>152.388235</td>
<td>827.631765</td>
</tr>
</tbody>
</table>
</div>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/05/18/20210518_SQL004/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Purple M. Stone">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Stone's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2021/05/18/20210518_SQL004/" class="post-title-link" itemprop="url">MySQLç¬”è®°(4)--æ•°æ®æ±‡æ€»</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-05-18 17:50:09 / ä¿®æ”¹æ—¶é—´ï¼š15:38:23" itemprop="dateCreated datePublished" datetime="2021-05-18T17:50:09+08:00">2021-05-18</time>
            </span>
          
            

            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Database/" itemprop="url" rel="index"><span itemprop="name">Database</span></a></span>

                
                
              
            </span>
          

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
        
      
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/2021/05/18/20210518_SQL004/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2021/05/18/20210518_SQL004/" itemprop="commentCount"></span></a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-èšåˆå‡½æ•°ï¼ˆAggregate-Functionsï¼‰"><a href="#1-èšåˆå‡½æ•°ï¼ˆAggregate-Functionsï¼‰" class="headerlink" title="1 èšåˆå‡½æ•°ï¼ˆAggregate Functionsï¼‰"></a>1 èšåˆå‡½æ•°ï¼ˆAggregate Functionsï¼‰</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="keyword">MAX</span>(invoice_total) <span class="keyword">AS</span> highest,</span><br><span class="line">    <span class="keyword">MIN</span>(invoice_total) <span class="keyword">AS</span> lowest,</span><br><span class="line">    <span class="keyword">AVG</span>(invoice_total) <span class="keyword">AS</span> average,</span><br><span class="line">    <span class="keyword">SUM</span>(invoice_total) <span class="keyword">AS</span> total,</span><br><span class="line">    <span class="keyword">SUM</span>(invoice_total * <span class="number">1.1</span>) <span class="keyword">AS</span> total2,</span><br><span class="line">    <span class="keyword">COUNT</span>(invoice_total) <span class="keyword">AS</span> number_of_invoices,</span><br><span class="line">    <span class="keyword">COUNT</span>(payment_date) <span class="keyword">AS</span> count_of_payments,		<span class="comment">-- COUNTåªè®¡ç®—éç©ºå€¼ä¸ªæ•°</span></span><br><span class="line">    <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> total_records,</span><br><span class="line">    <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> client_id) <span class="keyword">AS</span> total_clients 		<span class="comment">-- å»é™¤é‡å¤å€¼</span></span><br><span class="line"><span class="keyword">FROM</span> invoices</span><br><span class="line"><span class="keyword">WHERE</span> invoice_date &gt; <span class="string">'2019-07-01'</span></span><br></pre></td></tr></table></figure>
<p><strong>Exercise</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="string">'First half of 2019'</span> <span class="keyword">AS</span> date_range,</span><br><span class="line">    <span class="keyword">SUM</span>(invoice_total) <span class="keyword">AS</span> total_sales,</span><br><span class="line">    <span class="keyword">SUM</span>(payment_total) <span class="keyword">AS</span> total_payments,</span><br><span class="line">    <span class="keyword">SUM</span>(invoice_total - payment_total) <span class="keyword">AS</span> what_we_expect</span><br><span class="line"><span class="keyword">FROM</span> invoices</span><br><span class="line"><span class="keyword">WHERE</span> invoice_date <span class="keyword">BETWEEN</span> <span class="string">'2019-01-01'</span> <span class="keyword">AND</span> <span class="string">'2019-06-30'</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="string">'Second half of 2019'</span> <span class="keyword">AS</span> date_range,</span><br><span class="line">    <span class="keyword">SUM</span>(invoice_total) <span class="keyword">AS</span> total_sales,</span><br><span class="line">    <span class="keyword">SUM</span>(payment_total) <span class="keyword">AS</span> total_payments,</span><br><span class="line">    <span class="keyword">SUM</span>(invoice_total - payment_total) <span class="keyword">AS</span> what_we_expect</span><br><span class="line"><span class="keyword">FROM</span> invoices</span><br><span class="line"><span class="keyword">WHERE</span> invoice_date <span class="keyword">BETWEEN</span> <span class="string">'2019-07-01'</span> <span class="keyword">AND</span> <span class="string">'2019-12-31'</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="string">'Total'</span> <span class="keyword">AS</span> date_range,</span><br><span class="line">    <span class="keyword">SUM</span>(invoice_total) <span class="keyword">AS</span> total_sales,</span><br><span class="line">    <span class="keyword">SUM</span>(payment_total) <span class="keyword">AS</span> total_payments,</span><br><span class="line">    <span class="keyword">SUM</span>(invoice_total - payment_total) <span class="keyword">AS</span> what_we_expect</span><br><span class="line"><span class="keyword">FROM</span> invoices</span><br><span class="line"><span class="keyword">WHERE</span> invoice_date <span class="keyword">BETWEEN</span> <span class="string">'2019-01-01'</span> <span class="keyword">AND</span> <span class="string">'2019-12-31'</span></span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th>date_range</th>
<th>total_sales</th>
<th>total_payments</th>
<th>what_we_expect</th>
</tr>
</thead>
<tbody>
<tr>
<td>First half of 2019</td>
<td>1539.07</td>
<td>212.97</td>
<td>1326.1</td>
</tr>
<tr>
<td>Second half of 2019</td>
<td>1051.53</td>
<td>148.41</td>
<td>903.12</td>
</tr>
<tr>
<td>Total</td>
<td>2590.6</td>
<td>361.38</td>
<td>2229.22</td>
</tr>
</tbody>
</table>
</div>
<h1 id="2-GROUP-BY-å­å¥"><a href="#2-GROUP-BY-å­å¥" class="headerlink" title="2 GROUP BY å­å¥"></a>2 GROUP BY å­å¥</h1><p><strong>Demo 1</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    client_id,</span><br><span class="line">    <span class="keyword">SUM</span>(invoice_total) <span class="keyword">AS</span> total_sales</span><br><span class="line"><span class="keyword">FROM</span> invoices</span><br><span class="line"><span class="keyword">WHERE</span> invoice_date &gt;= <span class="string">'2019-07-01'</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> client_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> total_sales <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>
<p>âš  å„ä¸ªå­å¥çš„é¡ºåºä¸èƒ½é”™ï¼Œæ¯”å¦‚ä¸èƒ½å°†WHEREç§»åˆ°ORDER BY ä¸‹é¢</p>
<p>å¾—å‡ºæ¯ä¸ªclientåœ¨2019å¹´ä¸‹åŠå¹´çš„è®¢å•æ€»é‡‘é¢</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>client_id</th>
<th>total_sales</th>
</tr>
</thead>
<tbody>
<tr>
<td>5</td>
<td>489.52</td>
</tr>
<tr>
<td>3</td>
<td>427.54</td>
</tr>
<tr>
<td>1</td>
<td>134.47</td>
</tr>
</tbody>
</table>
</div>
<p><strong>Demo 2</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    state,</span><br><span class="line">    city,</span><br><span class="line">    <span class="keyword">SUM</span>(invoice_total) <span class="keyword">AS</span> total_sales</span><br><span class="line"><span class="keyword">FROM</span> invoices i</span><br><span class="line"><span class="keyword">JOIN</span> clients <span class="keyword">USING</span> (client_id)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> state, city</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°æ¯ä¸ªï¼ˆstate, cityï¼‰ç»„åˆçš„æ€»é‡‘é¢ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>state</th>
<th>city</th>
<th>total_sales</th>
</tr>
</thead>
<tbody>
<tr>
<td>NY</td>
<td>Syracuse</td>
<td>802.89</td>
</tr>
<tr>
<td>WV</td>
<td>Huntington</td>
<td>101.79</td>
</tr>
<tr>
<td>CA</td>
<td>San Francisco</td>
<td>705.90</td>
</tr>
<tr>
<td>OR</td>
<td>Portland</td>
<td>980.02</td>
</tr>
</tbody>
</table>
</div>
<p><strong>Exercise</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="built_in">date</span>,</span><br><span class="line">    pm.name <span class="keyword">AS</span> payment_method,</span><br><span class="line">    <span class="keyword">SUM</span>(amount) <span class="keyword">AS</span> total_payments</span><br><span class="line"><span class="keyword">FROM</span> payments p</span><br><span class="line"><span class="keyword">JOIN</span> payment_methods pm</span><br><span class="line">    <span class="keyword">ON</span> p.payment_method = pm.payment_method_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="built_in">date</span>, payment_method</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="built_in">date</span></span><br></pre></td></tr></table></figure>
<p>æ ¹æ®äº¤æ˜“æ—¥æœŸå’Œäº¤æ˜“æ–¹å¼æ±‚æ€»é‡‘é¢ã€‚</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>date</th>
<th>payment_method</th>
<th>total_payments</th>
</tr>
</thead>
<tbody>
<tr>
<td>2019-01-03</td>
<td>Credit Card</td>
<td>74.55</td>
</tr>
<tr>
<td>2019-01-08</td>
<td>Credit Card</td>
<td>32.77</td>
</tr>
<tr>
<td>2019-01-08</td>
<td>Cash</td>
<td>10.00</td>
</tr>
<tr>
<td>2019-01-11</td>
<td>Credit Card</td>
<td>0.03</td>
</tr>
<tr>
<td>2019-01-15</td>
<td>Credit Card</td>
<td>148.41</td>
</tr>
<tr>
<td>2019-01-26</td>
<td>Credit Card</td>
<td>87.44</td>
</tr>
<tr>
<td>2019-02-12</td>
<td>Credit Card</td>
<td>8.18</td>
</tr>
</tbody>
</table>
</div>
<h1 id="3-HAVING-å­å¥"><a href="#3-HAVING-å­å¥" class="headerlink" title="3 HAVING å­å¥"></a>3 HAVING å­å¥</h1><blockquote>
<p>ğŸ‘‰ ä½¿ç”¨WHEREå­å¥å¯ä»¥åœ¨è¡Œåˆ†ç»„ä¹‹<strong>å‰</strong>è¿‡æ»¤æ•°æ®<br>ğŸ‘‰ ä½¿ç”¨HAVINGå­å¥å¯ä»¥åœ¨è¡Œåˆ†ç»„ä¹‹<strong>å</strong>è¿‡æ»¤æ•°æ®</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    client_id,</span><br><span class="line">    <span class="keyword">SUM</span>(invoice_total) <span class="keyword">AS</span> total_sales</span><br><span class="line"><span class="keyword">FROM</span> invoices</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> client_id</span><br><span class="line"><span class="keyword">HAVING</span> total_sales &gt; <span class="number">500</span>  		<span class="comment">-- å¿…é¡»æ˜¯åœ¨selectå­å¥ä¸­çš„column</span></span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th>client_id</th>
<th>total_sales</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>802.89</td>
</tr>
<tr>
<td>3</td>
<td>705.90</td>
</tr>
<tr>
<td>5</td>
<td>980.02</td>
</tr>
</tbody>
</table>
</div>
<p><strong>å¤åˆæœç´¢æ¡ä»¶</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    client_id,</span><br><span class="line">    <span class="keyword">SUM</span>(invoice_total) <span class="keyword">AS</span> total_sales,</span><br><span class="line">    <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> number_of_invoices</span><br><span class="line"><span class="keyword">FROM</span> invoices</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> client_id</span><br><span class="line"><span class="keyword">HAVING</span> total_sales &gt; <span class="number">500</span> <span class="keyword">AND</span> number_of_invoices &gt; <span class="number">5</span></span><br></pre></td></tr></table></figure>
<p>è·å–é‡‘é¢è¶…è¿‡500å¹¶ä¸”å¤šäº5ä¸ªè®¢å•çš„clientçš„ç»“æœ</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>client_id</th>
<th>total_sales</th>
<th>number_of_invoices</th>
</tr>
</thead>
<tbody>
<tr>
<td>5</td>
<td>980.02</td>
<td>6</td>
</tr>
</tbody>
</table>
</div>
<p><strong>Exercise</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Get the customers located in VG</span></span><br><span class="line"><span class="comment">-- 		who have spent more than $100</span></span><br><span class="line"><span class="keyword">USE</span> sql_store;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    c.customer_id,</span><br><span class="line">    c.first_name,</span><br><span class="line">    c.last_name,</span><br><span class="line">    c.state,</span><br><span class="line">    <span class="keyword">SUM</span>(oi.quantity * oi.unit_price) <span class="keyword">AS</span> total_sales</span><br><span class="line"><span class="keyword">FROM</span> customers c</span><br><span class="line"><span class="keyword">JOIN</span> orders o <span class="keyword">USING</span> (customer_id)</span><br><span class="line"><span class="keyword">JOIN</span> order_items oi <span class="keyword">USING</span> (order_id)</span><br><span class="line"><span class="keyword">WHERE</span> state = <span class="string">'VA'</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">    c.customer_id,</span><br><span class="line">    c.first_name,</span><br><span class="line">    c.last_name</span><br><span class="line"><span class="keyword">HAVING</span> total_sales &gt; <span class="number">100</span></span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th>customer_id</th>
<th>first_name</th>
<th>last_name</th>
<th>state</th>
<th>total_sales</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>Ines</td>
<td>Brushfield</td>
<td>VA</td>
<td>157.92</td>
</tr>
</tbody>
</table>
</div>
<h1 id="4-ROLLUP-è¿ç®—ç¬¦"><a href="#4-ROLLUP-è¿ç®—ç¬¦" class="headerlink" title="4 ROLLUP è¿ç®—ç¬¦"></a>4 ROLLUP è¿ç®—ç¬¦</h1><p><strong>Demo 1</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    client_id,</span><br><span class="line">    <span class="keyword">SUM</span>(invoice_total) <span class="keyword">AS</span> total_sales</span><br><span class="line"><span class="keyword">FROM</span> invoices</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> client_id <span class="keyword">WITH</span> <span class="keyword">ROLLUP</span></span><br></pre></td></tr></table></figure>
<p>WITH ROLLUP è‡ªåŠ¨è®¡ç®—æ€»æ•°</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>client_id</th>
<th>total_sales</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>802.89</td>
</tr>
<tr>
<td>2</td>
<td>101.79</td>
</tr>
<tr>
<td>3</td>
<td>705.90</td>
</tr>
<tr>
<td>5</td>
<td>980.02</td>
</tr>
<tr>
<td></td>
<td>2590.60</td>
</tr>
</tbody>
</table>
</div>
<p><strong>Demo 2</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="built_in">date</span>,</span><br><span class="line">    pm.name <span class="keyword">AS</span> payment_method,</span><br><span class="line">    <span class="keyword">SUM</span>(amount) <span class="keyword">AS</span> total_payments</span><br><span class="line"><span class="keyword">FROM</span> payments p</span><br><span class="line"><span class="keyword">JOIN</span> payment_methods pm</span><br><span class="line">	<span class="keyword">ON</span> p.payment_method = pm.payment_method_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="built_in">date</span>, pm.name <span class="keyword">WITH</span> <span class="keyword">ROLLUP</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„: GROUP BY å­å¥ä¸­ç”±äºä½¿ç”¨äº† WITH ROLLUP, å°±ä¸èƒ½ä½¿ç”¨åˆ«å payment_method</p>
<p>å¾—åˆ°æ¯ä¸ªç»„åŠæ•´ä¸ªç»“æœé›†çš„æ±‡æ€»é›†:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>date</th>
<th>payment_method</th>
<th>total_payments</th>
</tr>
</thead>
<tbody>
<tr>
<td>2019-01-03</td>
<td>Credit Card</td>
<td>74.55</td>
</tr>
<tr>
<td>2019-01-03</td>
<td></td>
<td>74.55</td>
</tr>
<tr>
<td>2019-01-08</td>
<td>Cash</td>
<td>10.00</td>
</tr>
<tr>
<td>2019-01-08</td>
<td>Credit Card</td>
<td>32.77</td>
</tr>
<tr>
<td>2019-01-08</td>
<td></td>
<td>42.77</td>
</tr>
<tr>
<td>2019-01-11</td>
<td>Credit Card</td>
<td>0.03</td>
</tr>
<tr>
<td>2019-01-11</td>
<td></td>
<td>0.03</td>
</tr>
<tr>
<td>2019-01-15</td>
<td>Credit Card</td>
<td>148.41</td>
</tr>
<tr>
<td>2019-01-15</td>
<td></td>
<td>148.41</td>
</tr>
<tr>
<td>2019-01-26</td>
<td>Credit Card</td>
<td>87.44</td>
</tr>
<tr>
<td>2019-01-26</td>
<td></td>
<td>87.44</td>
</tr>
<tr>
<td>2019-02-12</td>
<td>Credit Card</td>
<td>8.18</td>
</tr>
<tr>
<td>2019-02-12</td>
<td></td>
<td>8.18</td>
</tr>
<tr>
<td></td>
<td></td>
<td>361.38</td>
</tr>
</tbody>
</table>
</div>
<p>æ³¨æ„åˆ° 2019-01-08 å¯¹ Cash å’Œ Credit Card  æœ‰ä¸€ä¸ªæ±‡æ€»å€¼.</p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/05/17/20210517_SQL003/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Purple M. Stone">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Stone's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2021/05/17/20210517_SQL003/" class="post-title-link" itemprop="url">MySQLç¬”è®°(3)--å¢åˆ æ”¹</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-05-17 21:50:09" itemprop="dateCreated datePublished" datetime="2021-05-17T21:50:09+08:00">2021-05-17</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-05-18 15:35:42" itemprop="dateModified" datetime="2021-05-18T15:35:42+08:00">2021-05-18</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Database/" itemprop="url" rel="index"><span itemprop="name">Database</span></a></span>

                
                
              
            </span>
          

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
        
      
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/2021/05/17/20210517_SQL003/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2021/05/17/20210517_SQL003/" itemprop="commentCount"></span></a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-åˆ—å±æ€§"><a href="#1-åˆ—å±æ€§" class="headerlink" title="1 åˆ—å±æ€§"></a>1 åˆ—å±æ€§</h1><blockquote>
<p><strong>Data type</strong></p>
<p>ğŸ‘‰ VARCHAR: å¯å˜é•¿åº¦å­—ç¬¦ä¸²ï¼ˆèŠ‚çœç©ºé—´ï¼‰<br>ğŸ‘‰ CHAR: å­—ç¬¦ä¸²ï¼Œä¸æ»¡æŒ‡å®šé•¿åº¦å°±ä¼šå¡«å……æ»¡</p>
<p><strong>Properties</strong></p>
<p>ğŸ‘‰ PK: Primary Key<br>ğŸ‘‰ NN: Not Null<br>ğŸ‘‰ AI: Automatic Increment</p>
</blockquote>
<h1 id="2-æ’å…¥"><a href="#2-æ’å…¥" class="headerlink" title="2 æ’å…¥"></a>2 æ’å…¥</h1><h2 id="2-1-æ’å…¥å•è¡Œ"><a href="#2-1-æ’å…¥å•è¡Œ" class="headerlink" title="2.1 æ’å…¥å•è¡Œ"></a>2.1 æ’å…¥å•è¡Œ</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> customers</span><br><span class="line"><span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="keyword">DEFAULT</span>, </span><br><span class="line">    <span class="string">'John'</span>, </span><br><span class="line">    <span class="string">'Smith'</span>, </span><br><span class="line">    <span class="string">'1990-01-01'</span>,</span><br><span class="line">    <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">'address'</span>,</span><br><span class="line">    <span class="string">'city'</span>,</span><br><span class="line">    <span class="string">'CA'</span>,</span><br><span class="line">    <span class="keyword">DEFAULT</span>)</span><br></pre></td></tr></table></figure>
<p>æœ‰äº›ä¸æ˜¯å¿…å¡«çš„, å¯ä»¥skipæ‰:</p>
<p><strong>Another Way</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> customers (</span><br><span class="line">    first_name,</span><br><span class="line">    last_name,</span><br><span class="line">    birth_date,</span><br><span class="line">    address,</span><br><span class="line">    city,</span><br><span class="line">    state)</span><br><span class="line"><span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="string">'John'</span>, </span><br><span class="line">    <span class="string">'Smith'</span>, </span><br><span class="line">    <span class="string">'1990-01-01'</span>,</span><br><span class="line">    <span class="string">'address'</span>,</span><br><span class="line">    <span class="string">'city'</span>,</span><br><span class="line">    <span class="string">'CA'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="2-2-æ’å…¥å¤šè¡Œ"><a href="#2-2-æ’å…¥å¤šè¡Œ" class="headerlink" title="2.2 æ’å…¥å¤šè¡Œ"></a>2.2 æ’å…¥å¤šè¡Œ</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> shippers (<span class="keyword">name</span>)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">'Shipper1'</span>), </span><br><span class="line">       (<span class="string">'Shipper2'</span>), </span><br><span class="line">       (<span class="string">'Shipper3'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="2-3-æ’å…¥åˆ†å±‚è¡Œ"><a href="#2-3-æ’å…¥åˆ†å±‚è¡Œ" class="headerlink" title="2.3 æ’å…¥åˆ†å±‚è¡Œ"></a>2.3 æ’å…¥åˆ†å±‚è¡Œ</h2><p>order_itemsæ˜¯ordersçš„å­è¡¨, åˆ—å‡ºæ›´ä¸ºè¯¦ç»†çš„ä¿¡æ¯.åœ¨ordersæ’å…¥è¡Œ, ç›¸åº”çš„åœ¨order_itemsä¹Ÿè¦æ’å…¥è¡Œ:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> orders (customer_id, order_date, <span class="keyword">status</span>)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">'2019-01-02'</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> order_items</span><br><span class="line"><span class="keyword">VALUES</span> </span><br><span class="line">    (<span class="keyword">LAST_INSERT_ID</span>(), <span class="number">1</span>, <span class="number">1</span>, <span class="number">2.95</span>),</span><br><span class="line">    (<span class="keyword">LAST_INSERT_ID</span>(), <span class="number">2</span>, <span class="number">1</span>, <span class="number">3.95</span>)</span><br></pre></td></tr></table></figure>
<p>LAST_INSERT_ID()ç›¸å½“äºä¸€ä¸ªmethod/function, ç›´æ¥è°ƒç”¨è·å–æœ€è¿‘æ’å…¥çš„recordçš„id.</p>
<h1 id="3-åˆ›å»ºå¤åˆ¶è¡¨-a-copy-of-table"><a href="#3-åˆ›å»ºå¤åˆ¶è¡¨-a-copy-of-table" class="headerlink" title="3 åˆ›å»ºå¤åˆ¶è¡¨(a copy of table)"></a>3 åˆ›å»ºå¤åˆ¶è¡¨(a copy of table)</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> orders_archived <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> orders</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡è¿™ç§æ–¹å¼åˆ›å»ºçš„è¡¨å¤åˆ¶ä¼šæ²¡æœ‰PK, AIè¿™äº›å±æ€§</p>
<h2 id="3-1-å­æŸ¥è¯¢"><a href="#3-1-å­æŸ¥è¯¢" class="headerlink" title="3.1 å­æŸ¥è¯¢"></a>3.1 å­æŸ¥è¯¢</h2><p>ä¸Šä¾‹ä¸­çš„SELECT * FROM ordersæ˜¯å­æŸ¥è¯¢.</p>
<p>INSERT INTOä¹Ÿå¯ä»¥ç”¨å­æŸ¥è¯¢:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> orders_archived</span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> orders</span><br><span class="line"><span class="keyword">WHERE</span> order_date &lt; <span class="string">'2019-01-01'</span></span><br></pre></td></tr></table></figure>
<p>orders_archivedè¡¨ä¸­åªæœ‰æ»¡è¶³æ¡ä»¶çš„records.</p>
<h1 id="4-æ›´æ–°"><a href="#4-æ›´æ–°" class="headerlink" title="4 æ›´æ–°"></a>4 æ›´æ–°</h1><h2 id="4-1-æ›´æ–°å•è¡Œ"><a href="#4-1-æ›´æ–°å•è¡Œ" class="headerlink" title="4.1 æ›´æ–°å•è¡Œ"></a>4.1 æ›´æ–°å•è¡Œ</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> invoices</span><br><span class="line"><span class="keyword">SET</span> payment_total = <span class="number">10</span>, payment_date = <span class="string">'2019-03-01'</span></span><br><span class="line"><span class="keyword">WHERE</span> invoice_id = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> invoices</span><br><span class="line"><span class="keyword">SET</span> payment_total = <span class="keyword">DEFAULT</span>, payment_date = <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">WHERE</span> invoice_id = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> invoices</span><br><span class="line"><span class="keyword">SET</span> </span><br><span class="line">    payment_total = invoice_total * <span class="number">0.5</span>, 	<span class="comment">-- ä½¿ç”¨è¡¨è¾¾å¼æ›´æ–°</span></span><br><span class="line">    payment_date = due_date</span><br><span class="line"><span class="keyword">WHERE</span> invoice_id = <span class="number">3</span></span><br></pre></td></tr></table></figure>
<h2 id="4-2-æ›´æ–°å¤šè¡Œ"><a href="#4-2-æ›´æ–°å¤šè¡Œ" class="headerlink" title="4.2 æ›´æ–°å¤šè¡Œ"></a>4.2 æ›´æ–°å¤šè¡Œ</h2><p>åœ¨MySQL workbenchéœ€è¦å–æ¶ˆsafe updateé€‰é¡¹æ‰èƒ½æ›´æ–°å¤šè¡Œ.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> invoices</span><br><span class="line"><span class="keyword">SET</span> </span><br><span class="line">    payment_total = invoice_total * <span class="number">0.5</span>, 	<span class="comment">-- ä½¿ç”¨è¡¨è¾¾å¼æ›´æ–°</span></span><br><span class="line">    payment_date = due_date</span><br><span class="line"><span class="keyword">WHERE</span> client_id = <span class="number">3</span></span><br><span class="line"><span class="comment">-- WHERE client_id IN (3, 4)</span></span><br></pre></td></tr></table></figure>
<p>client_id=3å¯¹åº”æœ‰å¤šé¡¹record, éƒ½ä¼šè¢«update</p>
<h2 id="4-3-åœ¨UPDATEä¸­ä½¿ç”¨å­æŸ¥è¯¢"><a href="#4-3-åœ¨UPDATEä¸­ä½¿ç”¨å­æŸ¥è¯¢" class="headerlink" title="4.3 åœ¨UPDATEä¸­ä½¿ç”¨å­æŸ¥è¯¢"></a>4.3 åœ¨UPDATEä¸­ä½¿ç”¨å­æŸ¥è¯¢</h2><p>å°†ä¸Šä¾‹æ”¹ä¸º:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> invoices</span><br><span class="line"><span class="keyword">SET</span> </span><br><span class="line">    payment_total = invoice_total * <span class="number">0.5</span>, 	<span class="comment">-- ä½¿ç”¨è¡¨è¾¾å¼æ›´æ–°</span></span><br><span class="line">    payment_date = due_date</span><br><span class="line"><span class="keyword">WHERE</span> client_id = </span><br><span class="line">        (<span class="keyword">SELECT</span> client_id</span><br><span class="line">         <span class="keyword">FROM</span> clients</span><br><span class="line">         <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'Myworks'</span>)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœå­æŸ¥è¯¢è¿”å›çš„æ˜¯å¤šä¸ªclient_id:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> invoices</span><br><span class="line"><span class="keyword">SET</span> </span><br><span class="line">    payment_total = invoice_total * <span class="number">0.5</span>, 	<span class="comment">-- ä½¿ç”¨è¡¨è¾¾å¼æ›´æ–°</span></span><br><span class="line">    payment_date = due_date</span><br><span class="line"><span class="keyword">WHERE</span> client_id <span class="keyword">IN</span>							<span class="comment">-- ç”¨IN</span></span><br><span class="line">        (<span class="keyword">SELECT</span> client_id</span><br><span class="line">         <span class="keyword">FROM</span> clients</span><br><span class="line">         <span class="keyword">WHERE</span> state <span class="keyword">IN</span> (<span class="string">'CA'</span>, <span class="string">'NY'</span>))</span><br></pre></td></tr></table></figure>
<p>âš  åœ¨æ‰§è¡ŒæŸ¥è¯¢ä¹‹å‰, åº”è¯¥å…ˆæ‰§è¡Œå­æŸ¥è¯¢çœ‹çœ‹å¯¹ä¸å¯¹.</p>
<h1 id="5-åˆ é™¤è¡Œ"><a href="#5-åˆ é™¤è¡Œ" class="headerlink" title="5 åˆ é™¤è¡Œ"></a>5 åˆ é™¤è¡Œ</h1><p><strong>æ ¹æ®æ¡ä»¶åˆ é™¤æŸäº›è¡Œ</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> invoices_archived</span><br><span class="line"><span class="keyword">WHERE</span> invoice_id = <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p><strong>å­æŸ¥è¯¢</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> invoices</span><br><span class="line"><span class="keyword">WHERE</span> invoice_id = </span><br><span class="line">        (<span class="keyword">SELECT</span> client_id</span><br><span class="line">         <span class="keyword">FROM</span> clients</span><br><span class="line">         <span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'Vinte'</span>)</span><br></pre></td></tr></table></figure>
<p><strong>åˆ é™¤æ•´è¡¨æ‰€æœ‰records</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> invoices_archived</span><br></pre></td></tr></table></figure>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/05/17/20210517_SQL002/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Purple M. Stone">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Stone's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2021/05/17/20210517_SQL002/" class="post-title-link" itemprop="url">MySQLç¬”è®°(2)--è¿æ¥</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-05-17 15:50:09" itemprop="dateCreated datePublished" datetime="2021-05-17T15:50:09+08:00">2021-05-17</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-05-18 15:30:42" itemprop="dateModified" datetime="2021-05-18T15:30:42+08:00">2021-05-18</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Database/" itemprop="url" rel="index"><span itemprop="name">Database</span></a></span>

                
                
              
            </span>
          

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
        
      
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/2021/05/17/20210517_SQL002/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2021/05/17/20210517_SQL002/" itemprop="commentCount"></span></a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="/images/SQL1/002_sql-join.png" alt="002_sql-join"></p>
<h1 id="1-Inner-Joins-å†…è¿æ¥"><a href="#1-Inner-Joins-å†…è¿æ¥" class="headerlink" title="1 Inner Joins (å†…è¿æ¥)"></a>1 Inner Joins (å†…è¿æ¥)</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> order_id, o.customer_id, first_name, last_name</span><br><span class="line"><span class="keyword">FROM</span> orders o</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> customers c</span><br><span class="line">    <span class="keyword">ON</span> o.customer_id = c.customer_id</span><br></pre></td></tr></table></figure>
<p>è¿”å›è¡¨ordersåœ¨è¡¨customersä¸­æœ‰å¯¹åº”recordçš„é¡¹</p>
<p>oå’Œcåˆ†åˆ«æ˜¯orderså’Œcustomersçš„åˆ«åï¼Œä»¥ç®€åŒ–ä»£ç </p>
<p>å…³é”®å­—INNERå¯çœç•¥</p>
<h2 id="1-1-è·¨æ•°æ®åº“è¿æ¥"><a href="#1-1-è·¨æ•°æ®åº“è¿æ¥" class="headerlink" title="1.1 è·¨æ•°æ®åº“è¿æ¥"></a>1.1 è·¨æ•°æ®åº“è¿æ¥</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> sql_store;  <span class="comment">-- é€‰æ‹©äº†æ•°æ®åº“sql_storeä¸ºå½“å‰æ•°æ®åº“</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> order_items oi</span><br><span class="line"><span class="keyword">JOIN</span> sql_inventory.products p   <span class="comment">-- å¦ä¸€ä¸ªæ•°æ®åº“sql_inventory</span></span><br><span class="line">    <span class="keyword">ON</span> oi.product_id = p.product_id</span><br></pre></td></tr></table></figure>
<h2 id="1-2-è‡ªè¿æ¥"><a href="#1-2-è‡ªè¿æ¥" class="headerlink" title="1.2 è‡ªè¿æ¥"></a>1.2 è‡ªè¿æ¥</h2><p>å°†è¡¨å’Œè‡ªå·±è¿æ¥ï¼Œä½†æ˜¯ç»™ä¸åŒçš„åˆ«åä»¥åŒºåˆ†ã€‚å¦‚ä¸‹ï¼Œmanagerä¹Ÿæ˜¯ä¸€åå‘˜å·¥ï¼Œå…¶ä¿¡æ¯ä¹Ÿåœ¨è¡¨employeesä¸­ï¼Œç”¨è‡ªè¿æ¥å¯ä»¥å¾—åˆ°employeeå’ŒTAçš„managerçš„å…·ä½“å‘˜å·¥ä¿¡æ¯ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> sql_hr;  <span class="comment">-- é€‰æ‹©äº†æ•°æ®åº“sql_hrä¸ºå½“å‰æ•°æ®åº“</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    e.employee_id,</span><br><span class="line">    e.first_name,</span><br><span class="line">    m.first_name <span class="keyword">AS</span> manager</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> employees m  </span><br><span class="line">    <span class="keyword">ON</span> e.reports_to = m.employee_id</span><br></pre></td></tr></table></figure>
<h2 id="1-3-å¤šè¡¨è¿æ¥"><a href="#1-3-å¤šè¡¨è¿æ¥" class="headerlink" title="1.3 å¤šè¡¨è¿æ¥"></a>1.3 å¤šè¡¨è¿æ¥</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> sql_store;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    o.order_id,</span><br><span class="line">    o.order_date,</span><br><span class="line">    c.first_name,</span><br><span class="line">    c.last_name,</span><br><span class="line">    os.name <span class="keyword">AS</span> <span class="keyword">status</span></span><br><span class="line"><span class="keyword">FROM</span> orders o</span><br><span class="line"><span class="keyword">JOIN</span> customers c</span><br><span class="line">    <span class="keyword">ON</span> o.customer_id = c.customer_id</span><br><span class="line"><span class="keyword">JOIN</span> order_statuses os</span><br><span class="line">    <span class="keyword">ON</span> o.status = os.order_status_id</span><br></pre></td></tr></table></figure>
<p>è¡¨orderså…ˆå’Œè¡¨customersè¿æ¥ï¼Œç„¶åä¸è¡¨order_statusesè¿æ¥ã€‚</p>
<h2 id="1-4-å¤åˆè¿æ¥æ¡ä»¶"><a href="#1-4-å¤åˆè¿æ¥æ¡ä»¶" class="headerlink" title="1.4 å¤åˆè¿æ¥æ¡ä»¶"></a>1.4 å¤åˆè¿æ¥æ¡ä»¶</h2><p>å¯¹äºæœ‰ä¸¤ä¸ªä¸»é”®çš„è¡¨ï¼Œè¦ç”¨ä¸¤ä¸ªä¸»é”®ä½œä¸ºæ¡ä»¶ä¸åˆ«çš„è¡¨è¿æ¥ã€‚ä¾‹å¦‚è¡¨order_itemsçš„ä¸»é”®æ˜¯order_idå’Œproduct_id</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> order_items oi</span><br><span class="line"><span class="keyword">JOIN</span> order_item_notes oin</span><br><span class="line">    <span class="keyword">ON</span> oi.order_id = oin.order_id</span><br><span class="line">    <span class="keyword">AND</span> oi.product_id = oin.product_id</span><br></pre></td></tr></table></figure>
<h2 id="1-5-éšå¼è¿æ¥è¯­æ³•"><a href="#1-5-éšå¼è¿æ¥è¯­æ³•" class="headerlink" title="1.5 éšå¼è¿æ¥è¯­æ³•"></a>1.5 éšå¼è¿æ¥è¯­æ³•</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> orders o</span><br><span class="line"><span class="keyword">JOIN</span> customers c</span><br><span class="line">    <span class="keyword">ON</span> o.customer_id = c.customer_id</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Implicit Join Syntax</span></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> orders o, customers c</span><br><span class="line"><span class="keyword">WHERE</span> o.customer_id = c.customer_id</span><br></pre></td></tr></table></figure>
<p>ä¸å»ºè®®ä½¿ç”¨éšå¼è¿æ¥è¯­æ³•ï¼Œè¦æ˜¯å¿˜å†™WHEREå°±å®Œäº†ã€‚</p>
<h1 id="2-å¤–è¿æ¥"><a href="#2-å¤–è¿æ¥" class="headerlink" title="2 å¤–è¿æ¥"></a>2 å¤–è¿æ¥</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    c.customer_id,</span><br><span class="line">    c.first_name,</span><br><span class="line">    o.order_id</span><br><span class="line"><span class="keyword">FROM</span> customers c</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> orders o</span><br><span class="line">    <span class="keyword">ON</span> c.customer_id = o.customer_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> c.customer_id</span><br></pre></td></tr></table></figure>
<p>LEFT (OUTER) JOIN å’Œ RIGHT (OUTER)  JOIN, OUTER å¯çœç•¥</p>
<h2 id="2-1-å¤šè¡¨å¤–è¿æ¥"><a href="#2-1-å¤šè¡¨å¤–è¿æ¥" class="headerlink" title="2.1 å¤šè¡¨å¤–è¿æ¥"></a>2.1 å¤šè¡¨å¤–è¿æ¥</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    c.customer_id,</span><br><span class="line">    c.first_name,</span><br><span class="line">    o.order_id,</span><br><span class="line">    sh.name <span class="keyword">AS</span> shipper</span><br><span class="line"><span class="keyword">FROM</span> customers c</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> orders o</span><br><span class="line">    <span class="keyword">ON</span> c.customer_id = o.customer_id</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> shippers sh</span><br><span class="line">    <span class="keyword">ON</span> o.shipper_id = sh.shipper_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> c.customer_id</span><br></pre></td></tr></table></figure>
<h2 id="2-2-è‡ªå¤–è¿æ¥"><a href="#2-2-è‡ªå¤–è¿æ¥" class="headerlink" title="2.2 è‡ªå¤–è¿æ¥"></a>2.2 è‡ªå¤–è¿æ¥</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> sql_hr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    e.employee_id,</span><br><span class="line">    e.first_name <span class="keyword">AS</span> employee,</span><br><span class="line">    m.employee_id <span class="keyword">AS</span> manager</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees m</span><br><span class="line">    <span class="keyword">ON</span> e.reports_to = m.employee_id</span><br></pre></td></tr></table></figure>
<h1 id="3-USINGå­å¥"><a href="#3-USINGå­å¥" class="headerlink" title="3 USINGå­å¥"></a>3 USINGå­å¥</h1><p>ä½¿ç”¨äºä¸¤å¼ è¡¨çš„é”®åå®Œå…¨ä¸€è‡´çš„æƒ…å†µ</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    o.order_id, </span><br><span class="line">    c.first_name,</span><br><span class="line">    sh.name <span class="keyword">AS</span> shipper</span><br><span class="line"><span class="keyword">FROM</span> orders o</span><br><span class="line"><span class="keyword">JOIN</span> customers c</span><br><span class="line">    <span class="comment">-- ON o.customer_id = c.customer_id </span></span><br><span class="line">    <span class="keyword">USING</span> (customer_id)</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> shippers sh</span><br><span class="line">    <span class="keyword">USING</span> (shipper_id)</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> order_items oi</span><br><span class="line"><span class="keyword">JOIN</span> order_item_notes oin</span><br><span class="line">    <span class="comment">-- ON oi.order_id = oin.order_id</span></span><br><span class="line">    <span class="comment">-- AND oi.product_id = oin.product_id</span></span><br><span class="line">    <span class="keyword">USING</span> (order_id, product_id)</span><br></pre></td></tr></table></figure>
<h1 id="4-è‡ªç„¶è¿æ¥"><a href="#4-è‡ªç„¶è¿æ¥" class="headerlink" title="4 è‡ªç„¶è¿æ¥"></a>4 è‡ªç„¶è¿æ¥</h1><p>è‡ªåŠ¨æ‰¾åˆ°åŒåçš„columnæ¥è¿æ¥ã€‚ï¼ˆå®¹æ˜“å‡ºé”™ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼‰</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    o.order_id,</span><br><span class="line">    c.first_name</span><br><span class="line"><span class="keyword">FROM</span> orders o</span><br><span class="line"><span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> customers c</span><br></pre></td></tr></table></figure>
<h1 id="5-äº¤å‰è¿æ¥"><a href="#5-äº¤å‰è¿æ¥" class="headerlink" title="5 äº¤å‰è¿æ¥"></a>5 äº¤å‰è¿æ¥</h1><p>è¿æ¥ä¸¤å¼ è¡¨çš„æ‰€æœ‰records</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    c.first_name <span class="keyword">AS</span> customers,</span><br><span class="line">    p.name <span class="keyword">AS</span> product</span><br><span class="line"><span class="keyword">FROM</span> customers c</span><br><span class="line"><span class="keyword">CROSS</span> <span class="keyword">JOIN</span> products p</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> c.first_name</span><br></pre></td></tr></table></figure>
<p>åº”ç”¨åœºæ™¯ï¼šè¡¨ä¸€æ˜¯å¤§ä¸­å°å‹å·ï¼Œè¡¨äºŒæ˜¯çº¢é»„è“ç­‰å„ç§é¢œè‰²ï¼Œå°†æ‰€æœ‰å‹å·å’Œæ‰€æœ‰é¢œè‰²ç»„åˆèµ·æ¥ã€‚</p>
<p><strong>éšå¼è¯­æ³•</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    c.first_name <span class="keyword">AS</span> customers,</span><br><span class="line">    p.name <span class="keyword">AS</span> product</span><br><span class="line"><span class="keyword">FROM</span> customers c, products p</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> c.first_name</span><br></pre></td></tr></table></figure>
<h1 id="6-è”åˆï¼ˆUnionsï¼‰"><a href="#6-è”åˆï¼ˆUnionsï¼‰" class="headerlink" title="6 è”åˆï¼ˆUnionsï¼‰"></a>6 è”åˆï¼ˆUnionsï¼‰</h1><p>ç­›é€‰æŸäº›recordsï¼Œç”¨unionå°†å¤šæ¬¡ç­›é€‰çš„ç»“æœè”åˆèµ·æ¥</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    order_id,</span><br><span class="line">    order_date,</span><br><span class="line">    <span class="string">'Active'</span> <span class="keyword">AS</span> <span class="keyword">status</span></span><br><span class="line"><span class="keyword">FROM</span> orders</span><br><span class="line"><span class="keyword">WHERE</span> order_date &gt;= <span class="string">'2019-01-01'</span>	<span class="comment">-- åœ¨æ­¤æ—¥æœŸåçš„order, çŠ¶æ€è®¾ä¸ºactive</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    order_id,</span><br><span class="line">    order_date,</span><br><span class="line">    <span class="string">'Archived'</span> <span class="keyword">AS</span> <span class="keyword">status</span>			<span class="comment">-- åœ¨æ­¤æ—¥æœŸå‰çš„order, çŠ¶æ€è®¾ä¸ºarchived</span></span><br><span class="line"><span class="keyword">FROM</span> orders</span><br><span class="line"><span class="keyword">WHERE</span> order_date &lt; <span class="string">'2019-01-01'</span></span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥è”åˆå¤šå¼ è¡¨</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> first_name  <span class="comment">-- å†³å®šåˆ—å</span></span><br><span class="line"><span class="keyword">FROM</span> customers</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span></span><br><span class="line"><span class="keyword">FROM</span> shippers</span><br></pre></td></tr></table></figure>
<p><strong>ç»ƒä¹ </strong></p>
<p>æ ¹æ®ç§¯åˆ†å°†é¡¾å®¢åˆ’åˆ†ä¸ºé‡‘é“¶é“œä¸‰æ¡£ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    customer_id,</span><br><span class="line">    first_name,</span><br><span class="line">    points,</span><br><span class="line">    <span class="string">'Bronze'</span> <span class="keyword">AS</span> <span class="keyword">type</span></span><br><span class="line"><span class="keyword">FROM</span> customers c</span><br><span class="line"><span class="keyword">WHERE</span> points &lt; <span class="number">2000</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    customer_id,</span><br><span class="line">    first_name,</span><br><span class="line">    points,</span><br><span class="line">    <span class="string">'silver'</span> <span class="keyword">AS</span> <span class="keyword">type</span></span><br><span class="line"><span class="keyword">FROM</span> customers c</span><br><span class="line"><span class="keyword">WHERE</span> points <span class="keyword">BETWEEN</span> <span class="number">2000</span> <span class="keyword">AND</span> <span class="number">3000</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    customer_id,</span><br><span class="line">    first_name,</span><br><span class="line">    points,</span><br><span class="line">    <span class="string">'Gold'</span> <span class="keyword">AS</span> <span class="keyword">type</span></span><br><span class="line"><span class="keyword">FROM</span> customers c</span><br><span class="line"><span class="keyword">WHERE</span> points &gt; <span class="number">3000</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> first_name</span><br></pre></td></tr></table></figure>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/05/16/20210516_SQL001/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Purple M. Stone">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Stone's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/2021/05/16/20210516_SQL001/" class="post-title-link" itemprop="url">MySQLç¬”è®°(1)--åŸºç¡€è¯­å¥</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-05-16 19:50:09" itemprop="dateCreated datePublished" datetime="2021-05-16T19:50:09+08:00">2021-05-16</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-05-18 15:31:16" itemprop="dateModified" datetime="2021-05-18T15:31:16+08:00">2021-05-18</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Database/" itemprop="url" rel="index"><span itemprop="name">Database</span></a></span>

                
                
              
            </span>
          

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
        
      
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/2021/05/16/20210516_SQL001/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2021/05/16/20210516_SQL001/" itemprop="commentCount"></span></a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="SELECT-å­å¥"><a href="#SELECT-å­å¥" class="headerlink" title="SELECT å­å¥"></a>SELECT å­å¥</h1><p>ä»ä¸€å¼ è¡¨ï¼ˆcustomersï¼‰ä¸­é€‰å–æŸäº›åˆ—</p>
<p><img src="/images/SQL1/001.png" style="zoom: 150%;"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    first_name, </span><br><span class="line">    last_name, </span><br><span class="line">    points, </span><br><span class="line">    points * <span class="number">10</span> + <span class="number">100</span> <span class="keyword">AS</span> <span class="string">"discount factor"</span>   <span class="comment">-- å¯ä»¥è¿›è¡Œæ•°å­¦è¿ç®—,ASæ¥rename</span></span><br><span class="line"><span class="keyword">FROM</span> customers</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> state <span class="comment">-- DISTINCT åªä¿ç•™é‡å¤é¡¹ä¸­çš„ä¸€é¡¹</span></span><br><span class="line"><span class="keyword">FROM</span> customers</span><br></pre></td></tr></table></figure>
<h1 id="WHERE-å­å¥"><a href="#WHERE-å­å¥" class="headerlink" title="WHERE å­å¥"></a>WHERE å­å¥</h1><p>è¿‡æ»¤ä½œç”¨ï¼Œæ ¹æ®æ¡ä»¶é€‰æ‹©records</p>
<p>(å„ä¸ªWHEREå­å¥åªæ˜¯æä¾›ä¸åŒçš„ç¤ºä¾‹ï¼Œè¿è¡Œæ—¶é€‰æ‹©ä¸€ä¸ªWHEREå­å¥ï¼Œå…¶ä½™æ³¨é‡Šæ‰ï¼Œä¸‹æ–‡åŒ)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> customers</span><br><span class="line"><span class="keyword">WHERE</span> state = <span class="string">'va'</span> <span class="comment">-- vaå¤§å°å†™ä¸€æ ·çš„</span></span><br><span class="line"><span class="keyword">WHERE</span> state &lt;&gt; <span class="string">'va'</span> <span class="comment">-- not in VA</span></span><br><span class="line"><span class="keyword">WHERE</span> birth_date &gt; <span class="string">'1990-01-01'</span> <span class="comment">-- born after 1990/01/01</span></span><br></pre></td></tr></table></figure>
<p>è¿ç®—ç¬¦æœ‰ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;</span><br><span class="line">&gt;=</span><br><span class="line">&lt;</span><br><span class="line">&lt;=</span><br><span class="line">=</span><br><span class="line">(not equal)  !=  or  &lt;&gt;</span><br></pre></td></tr></table></figure>
<h1 id="AND-OR-NOT-è¿ç®—ç¬¦"><a href="#AND-OR-NOT-è¿ç®—ç¬¦" class="headerlink" title="AND, OR, NOT è¿ç®—ç¬¦"></a>AND, OR, NOT è¿ç®—ç¬¦</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> customers</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> (birth_date &gt; <span class="string">'1990-01-01'</span> <span class="keyword">OR</span> points &gt; <span class="number">1000</span>)</span><br></pre></td></tr></table></figure>
<p>ANDä¼˜å…ˆçº§é«˜äºOR</p>
<h1 id="IN-è¿ç®—ç¬¦"><a href="#IN-è¿ç®—ç¬¦" class="headerlink" title="IN è¿ç®—ç¬¦"></a>IN è¿ç®—ç¬¦</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> customers</span><br><span class="line"><span class="comment">-- WHERE state = 'VA' OR state = 'GA' OR state = 'FL'</span></span><br><span class="line"><span class="comment">-- ç”¨INæ”¹å†™ï¼š</span></span><br><span class="line"><span class="keyword">WHERE</span> state <span class="keyword">IN</span> (<span class="string">'VA'</span>, <span class="string">'GA'</span>, <span class="string">'FL'</span>)</span><br><span class="line"><span class="comment">-- WHERE state NOT IN ('VA', 'GA', 'FL') -- è¿”å›ä¸åœ¨è¿™äº›å·çš„ records</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- è¿™æ ·æ˜¯é”™çš„ï¼šWHERE state = 'VA' OR 'GA' OR 'FL' </span></span><br><span class="line"><span class="comment">-- å› ä¸ºæˆ‘ä»¬ä¸èƒ½ç”¨ORè¿æ¥å¸ƒå°”è¡¨è¾¾å¼state = 'VA'å’Œå­—ç¬¦ä¸²'GA'</span></span><br></pre></td></tr></table></figure>
<h1 id="BETWEEN-è¿ç®—ç¬¦"><a href="#BETWEEN-è¿ç®—ç¬¦" class="headerlink" title="BETWEEN è¿ç®—ç¬¦"></a>BETWEEN è¿ç®—ç¬¦</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> customers</span><br><span class="line"><span class="comment">-- WHERE points &gt;= 1000 AND points &lt;=3000</span></span><br><span class="line"><span class="comment">-- æ”¹å†™ä¸ºï¼š</span></span><br><span class="line"><span class="keyword">WHERE</span> points <span class="keyword">BETWEEN</span> <span class="number">1000</span> <span class="keyword">AND</span> <span class="number">3000</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¹Ÿå¯ç”¨äºéæ•°å€¼</span></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> customers</span><br><span class="line"><span class="keyword">WHERE</span> birth_date <span class="keyword">BETWEEN</span> <span class="string">"1990-01-01"</span> <span class="keyword">AND</span> <span class="string">"2000-01-01"</span></span><br></pre></td></tr></table></figure>
<h1 id="LIKE-è¿ç®—ç¬¦"><a href="#LIKE-è¿ç®—ç¬¦" class="headerlink" title="LIKE è¿ç®—ç¬¦"></a>LIKE è¿ç®—ç¬¦</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å­—ç¬¦ä¸²æ¨¡å¼åŒ¹é…</span></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> customers</span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">'b%'</span> </span><br><span class="line"><span class="comment">-- å¾—åˆ°last nameä»¥'B'æˆ–'b'å¼€å¤´çš„records</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">'brush%'</span> </span><br><span class="line"><span class="comment">-- å¾—åˆ°last nameä»¥â€œbrushâ€å¼€å¤´çš„records</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">'%b%'</span> </span><br><span class="line"><span class="comment">-- è¡¨ç¤º'b'å‰åå¯ä»¥æœ‰ä»»æ„å­—ç¬¦æ•°('b'åœ¨å¼€å¤´ã€ä¸­é—´ã€ç»“å°¾å‡ºç°çš†å¯)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">'%y'</span> </span><br><span class="line"><span class="comment">-- å¾—åˆ°last nameä»¥'y'ç»“å°¾çš„records</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">'_____y'</span> </span><br><span class="line"><span class="comment">-- å¾—åˆ°last nameä»¥'y'ç»“å°¾ä¸”åªæœ‰6ä¸ªå­—ç¬¦('_'å¡«è¡¥è¡¨ç¤ºä»»æ„å­—ç¬¦)çš„records</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">'b____y'</span> </span><br><span class="line"><span class="comment">-- è¿è¡Œåå¾—åˆ°last nameä»¥'b'å¼€å¤´ä»¥'y'ç»“å°¾ä¸”åªæœ‰6ä¸ªå­—ç¬¦çš„record(æœ¬ä¾‹ä¸­ä¸º'Boagey')</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***SUMMARY**/</span> </span><br><span class="line">% any number of characters</span><br><span class="line">_ single character</span><br></pre></td></tr></table></figure>
<h1 id="REGEXP-è¿ç®—ç¬¦"><a href="#REGEXP-è¿ç®—ç¬¦" class="headerlink" title="REGEXP è¿ç®—ç¬¦"></a>REGEXP è¿ç®—ç¬¦</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- regular expression (REGEXP) æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> customers</span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">'%field%'</span></span><br><span class="line"><span class="comment">-- WHERE last_name REGEXP 'field'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> last_name REGEXP <span class="string">'^field'</span> </span><br><span class="line"><span class="comment">-- last name must starts with "field"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> last_name REGEXP <span class="string">'field$'</span> </span><br><span class="line"><span class="comment">-- last name must ends with "field"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* use '|' for multiple search pattern */</span> </span><br><span class="line"><span class="keyword">WHERE</span> last_name REGEXP <span class="string">'field|mac|rose'</span> </span><br><span class="line"><span class="comment">-- last name must contains "field" or "mac" or "rose"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> last_name REGEXP <span class="string">'field$|mac|rose'</span> </span><br><span class="line"><span class="comment">-- last name must ends with "field" or contains "mac"/"rose"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> last_name REGEXP <span class="string">'[gim]e'</span> </span><br><span class="line"><span class="comment">-- last name must contains "ge"/"ie"/"me"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> last_name REGEXP <span class="string">'e[gim]'</span> </span><br><span class="line"><span class="comment">-- last name must contains "eg"/"ei"/"em"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> last_name REGEXP <span class="string">'[a-h]e'</span></span><br><span class="line"><span class="comment">-- the same as WHERE last_name REGEXP '[abcdefgh]e'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">^ 	beginning</span><br><span class="line">$ 	end</span><br><span class="line">| 	logical or</span><br><span class="line">[abcd]</span><br><span class="line">[a-f]</span><br></pre></td></tr></table></figure>
<h1 id="IS-NULL-è¿ç®—ç¬¦"><a href="#IS-NULL-è¿ç®—ç¬¦" class="headerlink" title="IS NULL è¿ç®—ç¬¦"></a>IS NULL è¿ç®—ç¬¦</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> customers</span><br><span class="line"><span class="keyword">WHERE</span> phone <span class="keyword">IS</span> <span class="literal">NULL</span>  <span class="comment">-- è¿”å›æ²¡æœ‰phone(è¯¥å­—æ®µä¸ºNULL)çš„records</span></span><br><span class="line"><span class="keyword">WHERE</span> phone <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="comment">-- phoneä¸ä¸ºç©º</span></span><br></pre></td></tr></table></figure>
<h1 id="ORDER-BY-å­å¥"><a href="#ORDER-BY-å­å¥" class="headerlink" title="ORDER BY å­å¥"></a>ORDER BY å­å¥</h1><p>é»˜è®¤æ˜¯æŒ‰ç…§ä¸»é”®ï¼ˆprimary keyï¼‰æ’åºï¼Œä½¿ç”¨ORDER BY å­å¥å¯ä»¥æŒ‡å®šæ’åºçš„é”®</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> customers</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> first_name        <span class="comment">-- æ ¹æ®first_nameå­—æ®µå€¼å‡åºæ’åº</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> first_name <span class="keyword">DESC</span>   <span class="comment">-- æ ¹æ®first_nameå­—æ®µå€¼é™åºæ’åº</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> customers</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> state <span class="keyword">DESC</span>, first_name </span><br><span class="line"><span class="comment">--å…ˆæ ¹æ®stateé™åºæ’åˆ—ï¼Œstateç›¸åŒçš„æ ¹æ®first_nameå‡åºæ’åˆ—</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- birth_dateä¸åœ¨é€‰å‡ºæ¥çš„åˆ—é‡Œï¼Œstill work</span></span><br><span class="line"><span class="keyword">SELECT</span> first_name, last_name</span><br><span class="line"><span class="keyword">FROM</span> customers</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> birth_date</span><br></pre></td></tr></table></figure>
<h1 id="LIMIT-å­å¥"><a href="#LIMIT-å­å¥" class="headerlink" title="LIMIT å­å¥"></a>LIMIT å­å¥</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> customers</span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">3</span> 		<span class="comment">-- è¿”å›å‰3ä¸ªrecords</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">300</span> 		<span class="comment">-- 300 &gt; #record, è¿”å›å…¨éƒ¨records</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">6</span>, <span class="number">3</span>  	<span class="comment">-- è·³è¿‡å‰6ä¸ªrecordsï¼Œè¿”å›ç¬¬7ï¼Œ8ï¼Œ9ä¸ªrecords</span></span><br></pre></td></tr></table></figure>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">&gt;</a>
  </nav>

          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/avatar.gif"
      alt="Purple M. Stone">
  <p class="site-author-name" itemprop="name">Purple M. Stone</p>
  <div class="site-description" itemprop="description"></div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/%20%7C%7C%20archive">
        
          <span class="site-state-item-count">39</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/%20%7C%7C%20th">
          
        
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">åˆ†ç±»</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/%20%7C%7C%20tags">
          
        
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
        </a>
      </div>
    
  </nav>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Purple M. Stone</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> å¼ºåŠ›é©±åŠ¨ v4.2.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">ä¸»é¢˜ â€“ <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.4.0</div>

        
<div class="busuanzi-count">
  <script pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
  
    <span class="post-meta-divider">|</span>
  
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
  
</div>












        
      </div>
    </footer>
  </div>

  


    
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  <script src="/lib/pjax/pjax.min.js?v=0.2.8"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>

<script src="/js/utils.js?v=7.4.0.js"></script>

<script src="/js/motion.js?v=7.4.0.js"></script>


<script src="/js/schemes/pisces.js?v=7.4.0.js"></script>


<script src="/js/next-boot.js?v=7.4.0.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[pjax], script#page-configurations, #pjax script').forEach(element => {
    var id = element.id || '';
    var src = element.src || '';
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (id !=='') {
      script.id = element.id;
    }
    if (src !== '') {
      script.src = src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  








  
<script src="/js/local-search.js?v=7.4.0.js"></script>














    <div id="pjax">

  

  
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
    
      
<script type="text/x-mathjax-config">
    MathJax.Ajax.config.path['mhchem'] = '//cdn.jsdelivr.net/npm/mathjax-mhchem@3';

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        extensions: ['[mhchem]/mhchem.js'],
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script>

    
  

  

  


<script>
NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(item => {
    return GUEST.includes(item);
  });
  new Valine({
    el: '#comments',
    verify: true,
    notify: false,
    appId: 'XO7jV64HUREvBgMx83twoC5O-gzGzoHsz',
    appKey: 'Amg1FlPL6AX41b0bO42NfhcO',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: '' || 'zh-cn',
    path: location.pathname
  });
}, window.Valine);
</script>

    </div>
</body>
</html>
